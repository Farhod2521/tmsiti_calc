<!DOCTYPE html>
<html lang="uz">
<head>
    <title>Isitish Kalkulyatori</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <!-- CSS Files -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .form-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: none;
        }
        .form-section.active {
            display: block;
        }
        .section-title {
            color: #0d6efd;
            border-bottom: 2px solid #0d6efd;
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: #e9ecef;
            z-index: 1;
        }
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            cursor: pointer;
            flex: 1;
        }
        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-size: 1.2rem;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        .step.active .step-icon {
            background-color: #0d6efd;
            color: white;
        }
        .step.completed .step-icon {
            background-color: #198754;
            color: white;
        }
        .step-label {
            font-size: 0.85rem;
            text-align: center;
            color: #6c757d;
            font-weight: 500;
        }
        .step.active .step-label {
            color: #0d6efd;
            font-weight: 600;
        }
        .step.completed .step-label {
            color: #198754;
        }
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
        }
        .material-section {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .door-window-section {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }
        .add-btn {
            margin-top: 10px;
        }
        .door-window-item {
            border-bottom: 1px dashed #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .door-window-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .remove-btn {
            margin-top: 25px;
        }
        .area-display {
            background-color: #d1edff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #0d6efd;
        }
        .area-value {
            font-weight: bold;
            color: #198754;
            font-size: 1.1em;
        }
        .calculated-area {
            background-color: #e7f7ef;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            border-left: 3px solid #198754;
        }
        .temperature-info {
            background-color: #fff3cd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #ffc107;
        }
        .calculation-result {
            background-color: #d4edda;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #28a745;
            display: none;
        }
        .building-type-section {
            background-color: #e7f3ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <h1 class="text-center mb-4">Isitish Kalkulyatori</h1>
                
                <!-- Bosqichlar ko'rsatkichi -->
                <div class="step-indicator">
                    <div class="step active" data-step="1">
                        <div class="step-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <div class="step-label">Hudud va Bino</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-icon">
                            <i class="bi bi-aspect-ratio"></i>
                        </div>
                        <div class="step-label">Bino O'lchami</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-icon">
                            <i class="bi bi-puzzle"></i>
                        </div>
                        <div class="step-label">Konstruksiyalar</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-icon">
                            <i class="bi bi-calculator"></i>
                        </div>
                        <div class="step-label">Hisoblash</div>
                    </div>
                </div>
                
                <form id="buildingForm">
                    <!-- 1. Hudud va bino turi bo'limi -->
                    <div class="form-section active" id="step-1">
                        <h3 class="section-title">
                            <i class="bi bi-geo-alt"></i>
                            Hudud va Bino Turi
                        </h3>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="region" class="form-label required-field">Viloyat</label>
                                <select class="form-select" id="region" required>
                                    <option value="" selected disabled>Viloyatni tanlang</option>
                                    <!-- Viloyatlar API orqali yuklanadi -->
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="district" class="form-label required-field">Tuman</label>
                                <select class="form-select" id="district" required disabled>
                                    <option value="" selected disabled>Avval viloyatni tanlang</option>
                                </select>
                            </div>
                        </div>

                        <!-- Bino turi qismi -->
                        <div class="building-type-section">
                            <h5 class="text-primary mb-3">Bino Turi</h5>
                            <div class="mb-3">
                                <label for="buildingType" class="form-label required-field">Bino turi</label>
                                <select class="form-select" id="buildingType" required>
                                    <option value="" selected disabled>Bino turini tanlang</option>
                                    <option value="turar-joy" data-base-temp="21">Turar-joy binosi</option>
                                    <option value="kasalxona" data-base-temp="19">Kasalxona</option>
                                    <option value="oshxona" data-base-temp="18">Oshxona</option>
                                    <option value="maktab" data-base-temp="20">Maktab</option>
                                    <option value="universitet" data-base-temp="20">Universitet</option>
                                    <option value="ofis" data-base-temp="20">Ofis binosi</option>
                                    <option value="do'kon" data-base-temp="19">Do'kon</option>
                                    <option value="sanoat" data-base-temp="18">Sanoat binosi</option>
                                    <option value="sport" data-base-temp="19">Sport majmuasi</option>
                                    <option value="madaniyat" data-base-temp="20">Madaniyat markazi</option>
                                    <option value="boshqa" data-base-temp="20">Boshqa</option>
                                </select>
                            </div>
                            <div class="mb-3" id="otherBuildingType" style="display: none;">
                                <label for="customBuildingType" class="form-label">Bino turini kiriting</label>
                                <input type="text" class="form-control" id="customBuildingType" placeholder="Bino turini kiriting">
                            </div>
                        </div>
                        
                        <!-- Hudud ma'lumotlari -->
                        <div class="temperature-info" id="regionInfo" style="display: none;">
                            <h6>Hudud ma'lumotlari:</h6>
                            <div class="row">
                                <div class="col-md-3">
                                    <small>O'rtacha harorat: <span id="avgTempDisplay">-</span>°C</small>
                                </div>
                                <div class="col-md-3">
                                    <small>Vaqt: <span id="timeDisplay">-</span></small>
                                </div>
                                <div class="col-md-3">
                                    <small>Baza harorat: <span id="baseTempDisplay">-</span>°C</small>
                                </div>
                                <div class="col-md-3">
                                    <small>Hisob qiymati: <span id="calcValueDisplay">-</span></small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="navigation-buttons">
                            <div></div>
                            <button type="button" class="btn btn-primary next-step" data-next="2">Keyingi <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </div>

                    <!-- 2. Xona o'lchamlari bo'limi -->
                    <div class="form-section" id="step-2">
                        <h3 class="section-title">
                            <i class="bi bi-aspect-ratio"></i>
                            Bino O'lchami
                        </h3>
                        <div class="dimension-inputs">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="length" class="form-label required-field">Uzunlik (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control dimension-input" id="length" min="0" step="0.1" required>
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="width" class="form-label required-field">Eni (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control dimension-input" id="width" min="0" step="0.1" required>
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="height" class="form-label required-field">Balandligi (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control dimension-input" id="height" min="0" step="0.1" required>
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Avtomatik hisoblanadigan yuzalar -->
                            <div class="row mt-3">
                                <div class="col-md-4">
                                    <div class="area-display text-center">
                                        <h6>Devorlar Yuzasi</h6>
                                        <div class="area-value" id="wallAreaDisplay">0 m²</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="area-display text-center">
                                        <h6>Pol Yuzasi</h6>
                                        <div class="area-value" id="floorAreaDisplay">0 m²</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="area-display text-center">
                                        <h6>Tom Yuzasi</h6>
                                        <div class="area-value" id="ceilingAreaDisplay">0 m²</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="navigation-buttons">
                            <button type="button" class="btn btn-outline-secondary prev-step" data-prev="1"><i class="bi bi-arrow-left"></i> Oldingi</button>
                            <button type="button" class="btn btn-primary next-step" data-next="3">Keyingi <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </div>

                    <!-- 3. Konstruksiyalar bo'limi -->
                    <div class="form-section" id="step-3">
                        <h3 class="section-title">
                            <i class="bi bi-puzzle"></i>
                            Konstruksiyalar
                        </h3>
                        
                        <!-- Eshiklar qismi -->
                        <div class="door-window-section">
                            <h5 class="text-primary d-flex justify-content-between align-items-center">
                                <span>Eshiklar</span>
                                <button type="button" class="btn btn-sm btn-success add-btn" id="addDoor">
                                    <i class="bi bi-plus"></i> Qo'shish
                                </button>
                            </h5>
                            <div id="doorsContainer">
                                <!-- Eshiklar bu yerda yuklanadi -->
                            </div>
                        </div>
                        
                        <!-- Derazalar qismi -->
                        <div class="door-window-section">
                            <h5 class="text-primary d-flex justify-content-between align-items-center">
                                <span>Derazalar</span>
                                <button type="button" class="btn btn-sm btn-success add-btn" id="addWindow">
                                    <i class="bi bi-plus"></i> Qo'shish
                                </button>
                            </h5>
                            <div id="windowsContainer">
                                <!-- Derazalar bu yerda yuklanadi -->
                            </div>
                        </div>
                        
                        <!-- Materiallar -->
                        <div class="material-section">
                            <h5 class="text-primary">Devor</h5>
                            <div class="row">
                                <div class="col-md-5 mb-3">
                                    <label for="wallThickness" class="form-label">Devor qalinligi (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="wallThickness" min="0" step="0.01">
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                                <div class="col-md-5 mb-3">
                                    <label for="wallMaterial" class="form-label">Devor materiali</label>
                                    <select class="form-select" id="wallMaterial">
                                        <option value="" selected>Tanlang</option>
                                        <option value="g'isht">G'isht</option>
                                        <option value="beton">Beton</option>
                                        <option value="paneli">Paneli</option>
                                        <option value="yog'och">Yog'och</option>
                                        <option value="gazobeton">Gazobeton</option>
                                        <option value="boshqa">Boshqa</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label for="wallArea" class="form-label">Devor Yuzasi(m²)</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="wallArea" readonly style="background-color: #e9ecef;">
                                        <span class="input-group-text">m²</span>
                                    </div>
                                    <div class="calculated-area">
                                        <small>Jami eshiklar yuzasi: <span id="totalDoorsArea">0</span> m²</small><br>
                                        <small>Jami derazalar yuzasi: <span id="totalWindowsArea">0</span> m²</small><br>
                                        <small>Yakuniy devor yuzasi: <span id="finalWallArea">0</span> m²</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="material-section">
                            <h5 class="text-primary">Pol</h5>
                            <div class="row">
                                <div class="col-md-5 mb-3">
                                    <label for="floorThickness" class="form-label">Pol qalinligi (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="floorThickness" min="0" step="0.01">
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                                <div class="col-md-5 mb-3">
                                    <label for="floorMaterial" class="form-label">Pol materiali</label>
                                    <select class="form-select" id="floorMaterial">
                                        <option value="" selected>Tanlang</option>
                                        <option value="beton">Beton</option>
                                        <option value="parket">Parket</option>
                                        <option value="laminat">Laminat</option>
                                        <option value="plita">Plita</option>
                                        <option value="keramika">Keramika</option>
                                        <option value="boshqa">Boshqa</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label for="floorArea" class="form-label">Pol Yuzasi(m²)</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="floorArea" readonly style="background-color: #e9ecef;">
                                        <span class="input-group-text">m²</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="material-section">
                            <h5 class="text-primary">Tom</h5>
                            <div class="row">
                                <div class="col-md-5 mb-3">
                                    <label for="ceilingThickness" class="form-label">Tom qalinligi (m)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="ceilingThickness" min="0" step="0.01">
                                        <span class="input-group-text">m</span>
                                    </div>
                                </div>
                                <div class="col-md-5 mb-3">
                                    <label for="ceilingMaterial" class="form-label">Tom materiali</label>
                                    <select class="form-select" id="ceilingMaterial">
                                        <option value="" selected>Tanlang</option>
                                        <option value="beton">Beton</option>
                                        <option value="g'isht">G'isht</option>
                                        <option value="metall">Metall</option>
                                        <option value="yog'och">Yog'och</option>
                                        <option value="plastik">Plastik</option>
                                        <option value="boshqa">Boshqa</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label for="ceilingArea" class="form-label">Tom Yuzasi(m²)</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="ceilingArea" readonly style="background-color: #e9ecef;">
                                        <span class="input-group-text">m²</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="navigation-buttons">
                            <button type="button" class="btn btn-outline-secondary prev-step" data-prev="2"><i class="bi bi-arrow-left"></i> Oldingi</button>
                            <button type="button" class="btn btn-primary next-step" data-next="4">Keyingi <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </div>

                    <!-- 4. Hisoblash bo'limi -->
                    <div class="form-section" id="step-4">
                        <h3 class="section-title">
                            <i class="bi bi-calculator"></i>
                            Hisoblash Natijalari
                        </h3>
                        
                        <!-- Hisoblash natijalari -->
                        <div class="calculation-result" id="calculationResult">
                            <h5 class="text-success">Hisoblash natijalari:</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Hudud:</strong> <span id="resultRegion">-</span>, <span id="resultDistrict">-</span></p>
                                    <p><strong>Bino turi:</strong> <span id="resultBuildingType">-</span></p>
                                    <p><strong>O'rtacha harorat:</strong> <span id="resultAvgTemp">-</span>°C</p>
                                    <p><strong>Baza harorat:</strong> <span id="resultBaseTemp">-</span>°C</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Vaqt:</strong> <span id="resultTime">-</span></p>
                                    <p><strong>Bino o'lchami:</strong> <span id="resultDimensions">-</span></p>
                                    <p><strong>Devor yuzasi:</strong> <span id="resultWallArea">-</span> m²</p>
                                    <p><strong>Pol yuzasi:</strong> <span id="resultFloorArea">-</span> m²</p>
                                </div>
                            </div>
                            <hr>
                            <div class="text-center">
                                <h4 class="text-primary">Isitish qiymati: <span id="resultHeatingValue">-</span></h4>
                                <p class="text-muted">Formula: (Baza harorat - average_temperature) × time</p>
                            </div>
                        </div>
                        
                        <div class="navigation-buttons">
                            <button type="button" class="btn btn-outline-secondary prev-step" data-prev="3"><i class="bi bi-arrow-left"></i> Oldingi</button>
                            <button type="button" class="btn btn-success" id="calculateBtn">Hisoblash <i class="bi bi-calculator"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Global o'zgaruvchilar
        let regionsData = [];
        let selectedRegionData = null;
        let selectedDistrictData = null;
        let baseTemperature = 20; // Default baza harorati

        // DOM yuklanganda bajariladigan funksiyalar
        document.addEventListener('DOMContentLoaded', function() {
            // API dan viloyatlarni yuklash
            loadRegionsFromAPI();
            
            // Bino turi tanlanganda "Boshqa" tanlansa, qo'shimcha maydon ko'rsatish
            document.getElementById('buildingType').addEventListener('change', function() {
                const otherBuildingType = document.getElementById('otherBuildingType');
                if (this.value === 'boshqa') {
                    otherBuildingType.style.display = 'block';
                } else {
                    otherBuildingType.style.display = 'none';
                }
                
                // Baza haroratini yangilash
                const selectedOption = this.options[this.selectedIndex];
                baseTemperature = parseFloat(selectedOption.getAttribute('data-base-temp')) || 20;
                
                // Hudud ma'lumotlarini yangilash
                if (selectedDistrictData) {
                    displayRegionInfo();
                }
            });
            
            // Xona o'lchamlari o'zgarganda yuzalarni hisoblash
            const dimensionInputs = document.querySelectorAll('.dimension-input');
            dimensionInputs.forEach(input => {
                input.addEventListener('input', calculateAreas);
            });
            
            // Bosqichlar navigatsiyasi
            const steps = document.querySelectorAll('.step');
            const formSections = document.querySelectorAll('.form-section');
            
            // Bosqichlarga bosganda o'tish
            steps.forEach(step => {
                step.addEventListener('click', function() {
                    const stepNumber = this.getAttribute('data-step');
                    goToStep(stepNumber);
                });
            });
            
            // Keyingi bosqich tugmasi
            document.querySelectorAll('.next-step').forEach(button => {
                button.addEventListener('click', function() {
                    const nextStep = this.getAttribute('data-next');
                    goToStep(nextStep);
                });
            });
            
            // Oldingi bosqich tugmasi
            document.querySelectorAll('.prev-step').forEach(button => {
                button.addEventListener('click', function() {
                    const prevStep = this.getAttribute('data-prev');
                    goToStep(prevStep);
                });
            });
            
            // Eshik qo'shish
            let doorCount = 0;
            document.getElementById('addDoor').addEventListener('click', function() {
                doorCount++;
                addDoorItem(doorCount);
            });
            
            // Deraza qo'shish
            let windowCount = 0;
            document.getElementById('addWindow').addEventListener('click', function() {
                windowCount++;
                addWindowItem(windowCount);
            });
            
            // Hisoblash tugmasi
            document.getElementById('calculateBtn').addEventListener('click', calculateHeating);
            
            // Dastlabki yuzalarni hisoblash
            calculateAreas();
            
            // Dastlabki bir eshik va deraza qo'shish
            addDoorItem(1);
            addWindowItem(1);
        });
        
        // API dan viloyatlarni yuklash
        async function loadRegionsFromAPI() {
            try {
                const response = await fetch('https://calc.tmsiti.uz/api/v1/heating/api/regions-districts/');
                const data = await response.json();
                
                if (data.regions) {
                    regionsData = data.regions;
                    populateRegionsSelect();
                } else {
                    console.error('API dan ma\'lumotlar olinmadi');
                    // Agar API ishlamasa, fallback ma'lumotlarni yuklash
                    loadFallbackData();
                }
            } catch (error) {
                console.error('API dan ma\'lumotlar olishda xatolik:', error);
                // Agar API ishlamasa, fallback ma'lumotlarni yuklash
                loadFallbackData();
            }
        }
        
        // Fallback ma'lumotlar
        function loadFallbackData() {
            regionsData = [
                {
                    name: "Qoraqalpog'iston Respublikasi",
                    districts: [
                        { name: "Qoraqalpog", average_temperature: -2.4, time: 174 },
                        { name: "Moynoq", average_temperature: -1.2, time: 167 },
                        { name: "Nukus", average_temperature: -0.6, time: 143 },
                        { name: "Chimboy", average_temperature: -1.3, time: 163 }
                    ]
                },
                {
                    name: "Toshkent viloyati",
                    districts: [
                        { name: "Toshkent", average_temperature: 2.7, time: 129 },
                        { name: "Olmaliq", average_temperature: 3.2, time: 124 },
                        { name: "Ohangaron", average_temperature: 2.9, time: 135 }
                    ]
                },
                {
                    name: "Farg'ona viloyati",
                    districts: [
                        { name: "Farg'ona", average_temperature: 1.8, time: 131 },
                        { name: "Qo'qon", average_temperature: 1.9, time: 132 }
                    ]
                }
            ];
            populateRegionsSelect();
        }
        
        // Viloyatlarni select elementiga yuklash
        function populateRegionsSelect() {
            const regionSelect = document.getElementById('region');
            regionSelect.innerHTML = '<option value="" selected disabled>Viloyatni tanlang</option>';
            
            regionsData.forEach(region => {
                const option = document.createElement('option');
                option.value = region.name;
                option.textContent = region.name;
                option.setAttribute('data-region', JSON.stringify(region));
                regionSelect.appendChild(option);
            });
            
            // Viloyat tanlanganda tumanlarni yuklash
            regionSelect.addEventListener('change', function() {
                const districtSelect = document.getElementById('district');
                const selectedOption = this.options[this.selectedIndex];
                
                if (selectedOption.value) {
                    selectedRegionData = JSON.parse(selectedOption.getAttribute('data-region'));
                    districtSelect.innerHTML = '';
                    districtSelect.disabled = false;
                    
                    selectedRegionData.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.textContent = district.name;
                        option.setAttribute('data-district', JSON.stringify(district));
                        districtSelect.appendChild(option);
                    });
                    
                    // Tuman tanlanganda ma'lumotlarni ko'rsatish
                    districtSelect.addEventListener('change', function() {
                        const selectedDistrictOption = this.options[this.selectedIndex];
                        if (selectedDistrictOption.value) {
                            selectedDistrictData = JSON.parse(selectedDistrictOption.getAttribute('data-district'));
                            displayRegionInfo();
                        }
                    });
                } else {
                    districtSelect.disabled = true;
                    document.getElementById('regionInfo').style.display = 'none';
                }
            });
        }
        
        // Hudud ma'lumotlarini ko'rsatish
        function displayRegionInfo() {
            if (selectedDistrictData) {
                document.getElementById('avgTempDisplay').textContent = selectedDistrictData.average_temperature;
                document.getElementById('timeDisplay').textContent = selectedDistrictData.time;
                document.getElementById('baseTempDisplay').textContent = baseTemperature;
                
                const calcValue = (baseTemperature - selectedDistrictData.average_temperature) * selectedDistrictData.time;
                
                document.getElementById('calcValueDisplay').textContent = calcValue.toFixed(2);
                document.getElementById('regionInfo').style.display = 'block';
            }
        }
        
        // Bosqichga o'tish funksiyasi
        function goToStep(stepNumber) {
            // Bosqichlarni yangilash
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
                const stepNum = step.getAttribute('data-step');
                if (stepNum < stepNumber) {
                    step.classList.add('completed');
                } else if (stepNum == stepNumber) {
                    step.classList.add('active');
                }
            });
            
            // Form bo'limlarini yangilash
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`step-${stepNumber}`).classList.add('active');
        }
        
        // Eshik qo'shish funksiyasi
        function addDoorItem(id) {
            const container = document.getElementById('doorsContainer');
            const doorItem = document.createElement('div');
            doorItem.className = 'door-window-item';
            doorItem.innerHTML = `
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Eshik ${id} eni (m)</label>
                        <div class="input-group">
                            <input type="number" class="form-control door-width" min="0" step="0.01" value="0.9">
                            <span class="input-group-text">m</span>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Eshik ${id} balandligi (m)</label>
                        <div class="input-group">
                            <input type="number" class="form-control door-height" min="0" step="0.01" value="2.1">
                            <span class="input-group-text">m</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Eshik ${id} materiali</label>
                        <select class="form-select door-material">
                            <option value="yog'och">Yog'och</option>
                            <option value="metall">Metall</option>
                            <option value="plastik">Plastik</option>
                            <option value="shisha">Shisha</option>
                            <option value="boshqa">Boshqa</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label">Yuzasi</label>
                        <div class="input-group">
                            <input type="text" class="form-control door-area" readonly style="background-color: #e9ecef;">
                            <span class="input-group-text">m²</span>
                        </div>
                        ${id > 1 ? `<button type="button" class="btn btn-sm btn-danger remove-btn w-100 mt-2" onclick="this.closest('.door-window-item').remove(); calculateDoorWindowAreas();">
                            <i class="bi bi-trash"></i> O'chirish
                        </button>` : ''}
                    </div>
                </div>
            `;
            container.appendChild(doorItem);
            
            // Eshik o'lchamlari o'zgarganda yuzani hisoblash
            const widthInput = doorItem.querySelector('.door-width');
            const heightInput = doorItem.querySelector('.door-height');
            const areaInput = doorItem.querySelector('.door-area');
            
            function calculateDoorArea() {
                const width = parseFloat(widthInput.value) || 0;
                const height = parseFloat(heightInput.value) || 0;
                const area = width * height;
                areaInput.value = area.toFixed(2);
                calculateDoorWindowAreas();
            }
            
            widthInput.addEventListener('input', calculateDoorArea);
            heightInput.addEventListener('input', calculateDoorArea);
            
            // Dastlabki hisoblash
            calculateDoorArea();
        }
        
        // Deraza qo'shish funksiyasi
        function addWindowItem(id) {
            const container = document.getElementById('windowsContainer');
            const windowItem = document.createElement('div');
            windowItem.className = 'door-window-item';
            windowItem.innerHTML = `
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Deraza ${id} eni (m)</label>
                        <div class="input-group">
                            <input type="number" class="form-control window-width" min="0" step="0.01" value="1.2">
                            <span class="input-group-text">m</span>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label">Deraza ${id} balandligi (m)</label>
                        <div class="input-group">
                            <input type="number" class="form-control window-height" min="0" step="0.01" value="1.5">
                            <span class="input-group-text">m</span>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Deraza ${id} materiali</label>
                        <select class="form-select window-material">
                            <option value="yog'och">Yog'och</option>
                            <option value="metall">Metall</option>
                            <option value="plastik">Plastik</option>
                            <option value="alyuminiy">Alyuminiy</option>
                            <option value="boshqa">Boshqa</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label">Yuzasi</label>
                        <div class="input-group">
                            <input type="text" class="form-control window-area" readonly style="background-color: #e9ecef;">
                            <span class="input-group-text">m²</span>
                        </div>
                        ${id > 1 ? `<button type="button" class="btn btn-sm btn-danger remove-btn w-100 mt-2" onclick="this.closest('.door-window-item').remove(); calculateDoorWindowAreas();">
                            <i class="bi bi-trash"></i> O'chirish
                        </button>` : ''}
                    </div>
                </div>
            `;
            container.appendChild(windowItem);
            
            // Deraza o'lchamlari o'zgarganda yuzani hisoblash
            const widthInput = windowItem.querySelector('.window-width');
            const heightInput = windowItem.querySelector('.window-height');
            const areaInput = windowItem.querySelector('.window-area');
            
            function calculateWindowArea() {
                const width = parseFloat(widthInput.value) || 0;
                const height = parseFloat(heightInput.value) || 0;
                const area = width * height;
                areaInput.value = area.toFixed(2);
                calculateDoorWindowAreas();
            }
            
            widthInput.addEventListener('input', calculateWindowArea);
            heightInput.addEventListener('input', calculateWindowArea);
            
            // Dastlabki hisoblash
            calculateWindowArea();
        }
        
        // Eshik va derazalarning umumiy yuzasini hisoblash
        function calculateDoorWindowAreas() {
            let totalDoorsArea = 0;
            let totalWindowsArea = 0;
            
            // Eshiklarning yuzasini hisoblash
            document.querySelectorAll('.door-area').forEach(areaInput => {
                totalDoorsArea += parseFloat(areaInput.value) || 0;
            });
            
            // Derazalarning yuzasini hisoblash
            document.querySelectorAll('.window-area').forEach(areaInput => {
                totalWindowsArea += parseFloat(areaInput.value) || 0;
            });
            
            // Jami yuzalarni ko'rsatish
            document.getElementById('totalDoorsArea').textContent = totalDoorsArea.toFixed(2);
            document.getElementById('totalWindowsArea').textContent = totalWindowsArea.toFixed(2);
            
            // Yakuniy devor yuzasini hisoblash
            const wallArea = parseFloat(document.getElementById('wallArea').value) || 0;
            const finalWallArea = wallArea - totalDoorsArea - totalWindowsArea;
            document.getElementById('finalWallArea').textContent = finalWallArea.toFixed(2);
        }
        
        // Yuzalarni hisoblash funksiyasi
        function calculateAreas() {
            const length = parseFloat(document.getElementById('length').value) || 0;
            const width = parseFloat(document.getElementById('width').value) || 0;
            const height = parseFloat(document.getElementById('height').value) || 0;
            
            // Devorlar yuzasi (2*(uzunlik+eni)*balandlik)
            const wallArea = 2 * (length + width) * height;
            document.getElementById('wallArea').value = wallArea.toFixed(2);
            document.getElementById('wallAreaDisplay').textContent = wallArea.toFixed(2) + ' m²';
            
            // Pol yuzasi (uzunlik * eni)
            const floorArea = length * width;
            document.getElementById('floorArea').value = floorArea.toFixed(2);
            document.getElementById('floorAreaDisplay').textContent = floorArea.toFixed(2) + ' m²';
            
            // Tom yuzasi (uzunlik * eni)
            const ceilingArea = length * width;
            document.getElementById('ceilingArea').value = ceilingArea.toFixed(2);
            document.getElementById('ceilingAreaDisplay').textContent = ceilingArea.toFixed(2) + ' m²';
            
            // Eshik va derazalarning yuzasini qayta hisoblash
            calculateDoorWindowAreas();
        }
        
        // Isitish qiymatini hisoblash
        function calculateHeating() {
            if (!selectedDistrictData) {
                alert('Iltimos, avval hududni tanlang!');
                goToStep(1);
                return;
            }
            
            // Ma'lumotlarni yig'ish
            const region = document.getElementById('region').value;
            const district = document.getElementById('district').value;
            const buildingType = document.getElementById('buildingType').value;
            const customBuildingType = document.getElementById('customBuildingType').value;
            const length = document.getElementById('length').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            
            // Bino turi nomini olish
            const buildingTypeSelect = document.getElementById('buildingType');
            const selectedBuildingOption = buildingTypeSelect.options[buildingTypeSelect.selectedIndex];
            const buildingTypeName = buildingType === 'boshqa' ? customBuildingType : selectedBuildingOption.textContent;
            
            // Hisoblash formulasi
            const heatingValue = (baseTemperature - selectedDistrictData.average_temperature) * selectedDistrictData.time;
            
            // Natijalarni ko'rsatish
            document.getElementById('resultRegion').textContent = region;
            document.getElementById('resultDistrict').textContent = district;
            document.getElementById('resultBuildingType').textContent = buildingTypeName;
            document.getElementById('resultAvgTemp').textContent = selectedDistrictData.average_temperature;
            document.getElementById('resultBaseTemp').textContent = baseTemperature;
            document.getElementById('resultTime').textContent = selectedDistrictData.time;
            document.getElementById('resultDimensions').textContent = `${length}m × ${width}m × ${height}m`;
            document.getElementById('resultWallArea').textContent = document.getElementById('wallArea').value;
            document.getElementById('resultFloorArea').textContent = document.getElementById('floorArea').value;
            document.getElementById('resultHeatingValue').textContent = heatingValue.toFixed(2);
            
            // Natijalarni ko'rsatish
            document.getElementById('calculationResult').style.display = 'block';
            
            // Natijalarga scroll qilish
            document.getElementById('calculationResult').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>