<!DOCTYPE html>
<html lang="en">

<head>
    <title>TMSITI - Yorug'lik Kalkulyatori</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Yorug'lik hisoblash kalkulyatori - Texnik me'yorlash va standartlashtirish instituti" name="description">
    <meta content="yorug'lik, kalkulyator, lampa, hisoblash, dizayn, me'yorlash" name="keywords">
    <meta content="TMSITI" name="author">
    
    <!-- CSS Files -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/plugins.css" rel="stylesheet" type="text/css">
    <link href="css/swiper.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/coloring.css" rel="stylesheet" type="text/css">
    <!-- color scheme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
    
    <style>
        :root {
            --primary-color: #1a3668;
            --secondary-color: #234982;
            --accent-color: #4a90e2;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 12px;
            --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .main-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 40px;
            margin: 40px auto;
            max-width: 1400px;
            position: relative;
            overflow: hidden;
        }
        
        .main-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .section-title {
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 2px;
        }
        
        .parameter-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            height: 100%;
            border: 1px solid #eef2f7;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .parameter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .parameter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .param-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 15px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .param-label i {
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        .input-group-custom {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .btn-counter {
            background: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            color: white;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(26, 54, 104, 0.2);
        }
        
        .btn-counter:hover {
            background: var(--accent-color);
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(26, 54, 104, 0.3);
        }
        
        .value-input {
            width: 90px;
            text-align: center;
            border: 2px solid #e0e6ef;
            border-radius: 8px;
            padding: 10px;
            margin: 0 12px;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            transition: var(--transition);
        }
        
        .value-input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .unit-label {
            color: #6c757d;
            font-size: 0.9rem;
            background: #f8f9fa;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 5px;
        }
        
        .area-display {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 15px 35px rgba(26, 54, 104, 0.2);
            position: relative;
            overflow: hidden;
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 15px 35px rgba(26, 54, 104, 0.2); }
            50% { box-shadow: 0 15px 40px rgba(26, 54, 104, 0.4); }
        }
        
        .area-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .area-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        
        .area-label {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .select-container {
            margin-bottom: 25px;
        }
        
        .select-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
            display: block;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .select-label i {
            color: var(--accent-color);
        }
        
        .custom-select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e6ef;
            border-radius: 10px;
            background-color: white;
            font-size: 1rem;
            color: var(--dark-color);
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23234982' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }
        
        .custom-select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .room-image-container {
            position: relative;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .room-image-container img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: var(--transition);
        }
        
        .room-image-container img:hover {
            transform: scale(1.02);
        }
        
        .dimension-line {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        
        .dimension-line-horizontal {
            transform: translateX(-50%);
        }
        
        .dimension-line-vertical {
            transform: translateY(-50%);
        }
        
        .results-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: var(--box-shadow);
            border-left: 5px solid var(--accent-color);
        }
        
        .results-container h5 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f4f8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .results-container h5 i {
            color: var(--accent-color);
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .table th {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
            border: none;
            padding: 18px 20px;
            text-align: center;
            vertical-align: middle;
        }
        
        .table td {
            padding: 16px 20px;
            vertical-align: middle;
            border-bottom: 1px solid #f0f4f8;
            text-align: center;
        }
        
        .table tbody tr:nth-child(even) {
            background-color: #fafcfd;
        }
        
        .table tbody tr:hover {
            background-color: #f0f7ff;
            transition: var(--transition);
        }
        
        .total-light-display {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-top: 25px;
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.2);
            animation: pulse 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .total-light-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 15s linear infinite;
        }
        
        .total-light-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .total-light-label {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .lamp-category-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .lamp-category-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.1);
            border-color: var(--accent-color);
        }
        
        .lamp-category-card.active {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, #f0f7ff, #e8f2ff);
            box-shadow: 0 10px 20px rgba(74, 144, 226, 0.2);
        }
        
        .lamp-category-image {
            width: 90px;
            height: 90px;
            object-fit: contain;
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .lamp-category-card:hover .lamp-category-image {
            transform: scale(1.1);
        }
        
        .lamp-category-name {
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .lamps-count-badge {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            border-radius: 20px;
            padding: 6px 15px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            box-shadow: 0 3px 8px rgba(74, 144, 226, 0.3);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal uchun stillar */
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-bottom: none;
            padding: 20px 30px;
        }

        .modal-title {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            border-top: 1px solid #eef2f7;
            padding: 20px 30px;
        }

        .placement-canvas-container {
            border: 2px solid #eef2f7;
            border-radius: 10px;
            padding: 15px;
            background-color: #fafcfd;
            overflow: auto;
            max-height: 500px;
        }

        .placement-info {
            background: linear-gradient(135deg, #f8fafc, #f0f7ff);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--secondary-color);
            height: 100%;
        }

        .placement-controls {
            background: linear-gradient(135deg, #f8fafc, #f0f7ff);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid var(--success-color);
            height: 100%;
        }

        .btn-details {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(35, 73, 130, 0.2);
        }

        .btn-details:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(35, 73, 130, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(35, 73, 130, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(35, 73, 130, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            border: none;
            padding: 12px 28px;
            border-radius: 8px;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        /* Tavsiya qilingan lampochkalar uchun stillar */
        .recommended-lamps-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: var(--box-shadow);
            border: 2px solid var(--accent-color);
            position: relative;
            overflow: hidden;
        }
        
        .recommended-lamps-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
        }
        
        .recommended-lamps-title {
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .recommended-lamps-title i {
            color: var(--accent-color);
        }
        
        /* Logo uchun stillar */
        #logo {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            max-width: 500px;
            margin: 10px auto;
            transition: var(--transition);
        }

        #logo:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        #logo a {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: inherit;
            width: 100%;
        }

        .logo-main {
            width: 55px;
            height: 55px;
            padding: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(26, 54, 104, 0.2);
            flex-shrink: 0;
        }

        #logo h6 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 14px;
            font-weight: 700;
            line-height: 1.4;
            margin: 0;
            text-align: left;
            flex: 1;
        }

        .logo-scroll, .logo-mobile {
            display: none;
        }

        /* Responsive dizayn */
        @media (max-width: 1200px) {
            .main-container {
                padding: 30px;
                margin: 30px 15px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .area-value, .total-light-value {
                font-size: 2rem;
            }
        }

        @media (max-width: 992px) {
            .main-container {
                padding: 25px;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
            
            .parameter-card {
                padding: 20px;
            }
            
            .table th, .table td {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px 15px;
                margin: 20px 10px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .area-display, .total-light-display {
                padding: 20px;
            }
            
            .area-value, .total-light-value {
                font-size: 1.8rem;
            }
            
            .value-input {
                width: 70px;
                font-size: 1rem;
                padding: 8px;
            }
            
            .btn-counter {
                width: 36px;
                height: 36px;
                font-size: 1rem;
            }
            
            .results-container {
                padding: 20px;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            #logo {
                padding: 12px 15px;
                max-width: 90%;
            }
            
            .logo-main {
                width: 45px;
                height: 45px;
            }
            
            #logo h6 {
                font-size: 12px;
            }
        }

        @media (max-width: 576px) {
            .params-section .col-12 {
                margin-bottom: 15px;
            }
            
            .input-group-custom {
                margin-bottom: 5px;
            }
            
            .custom-select {
                padding: 12px 15px;
            }
            
            .lamp-category-card {
                padding: 20px 15px;
            }
            
            .lamp-category-image {
                width: 70px;
                height: 70px;
            }
            
            .modal-xl {
                max-width: 95%;
                margin: 10px auto;
            }
        }

        /* Animatsiyalar */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Yuklash animatsiyasi */
        .loader {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        /* Scrollbar stil */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 350px;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-success .notification-icon {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }
        
        .notification-error .notification-icon {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }
        
        .notification-info .notification-icon {
            background: rgba(74, 144, 226, 0.1);
            color: var(--accent-color);
        }
        
        .notification-content h6 {
            margin: 0;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .notification-content p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            margin-left: auto;
            flex-shrink: 0;
        }
        
        /* Progress bar */
        .progress-container {
            width: 100%;
            background: #eef2f7;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            height: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>
    <!-- Notification container -->
    <div id="notificationContainer"></div>
    
    <div id="wrapper">
        <div class="float-text show-on-scroll">
            <span><a href="#"><i class="fas fa-chevron-up"></i> Yuqoriga</a></span>
        </div>
        <div class="scrollbar-v show-on-scroll"></div>
        
        <!-- page preloader -->
        <div id="de-loader"></div>
        <!-- page preloader close -->

        <!-- header begin -->
        <header class="header-light transparent scroll-light has-topbar">
            <div id="topbar">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between xs-hide">
                                <div class="header-widget d-flex">
                                    <div class="topbar-widget"><a href="#"><i class="fas fa-phone"></i>+998 71 244-51-84</a></div>
                                    <div class="topbar-widget"><a href="#"><i class="fas fa-envelope"></i>info@tmsiti.uz</a></div>
                                </div>

                                <div class="social-icons">
                                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                                    <a href="#"><i class="fab fa-twitter"></i></a>
                                    <a href="#"><i class="fab fa-youtube"></i></a>
                                    <a href="#"><i class="fab fa-pinterest-p"></i></a>
                                    <a href="#"><i class="fab fa-instagram"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <!-- logo begin -->
                                <div id="logo">
                                    <a href="index.html">
                                        <img class="logo-main" src="https://tmsiti.uz/icons/brand.svg" alt="Institut Logosi">
                                        <h6>
                                        Texnik me'yorlash va<br>
                                        standartlashtirish<br>
                                        ilmiy-tadqiqot instituti
                                        </h6>
                                    </a>
                                </div>
                                <!-- logo close -->
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <ul id="mainmenu">
                                    <li><a class="menu-item" href="#"><i class="fas fa-home"></i> Bosh sahifa</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-info-circle"></i> Biz haqimizda</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-project-diagram"></i> Loyihalar</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-blog"></i> Blog</a></li>
                                </ul>
                            </div>
                            <div class="de-flex-col">
                                <div class="menu_side_area">          
                                   <a href="#" class="btn-main bg-color-2"><i class="fas fa-phone-alt"></i> Bog'lanish</a>
                                    <span id="menu-btn"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- header close -->
        
        <!-- content begin -->
        <div class="no-bottom no-top" id="content">
            <div id="top"></div>
            
            <!-- section begin -->
            <section id="subheader2">
                <div class="container relative z-index-1000">
                    <div class="row align-items-center">
                        <div class="col-lg-6 offset-lg-3 text-center">
                            <h1 class="section-title slide-in-left">Yorug'lik Kalkulyatori</h1>
                            <p class="text-muted slide-in-right">Xona parametrlari bo'yicha optimal yorug'likni hisoblang va lampochkalarni joylashtiring</p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- section close -->

            <section class="no-top">
                <div class="container-xxl">
                    <div class="main-container fade-in">
                        <div class="row">
                            <!-- Chap tomon: Parametrlar va Selektlar -->
                            <div class="col-lg-6 col-md-12">
                                <div class="row params-section">
                                    <!-- Kenglik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card slide-in-left">
                                            <div class="param-label">
                                                <i class="fas fa-arrows-alt-h"></i> Kenglik
                                            </div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('width')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="widthValue" 
                                                    value="4.6" 
                                                    step="0.1"
                                                    min="0.1"
                                                    onchange="updateFromInput('width')">
                                                <button class="btn-counter" onclick="increaseValue('width')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">metr</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Uzunlik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card slide-in-left" style="animation-delay: 0.1s">
                                            <div class="param-label">
                                                <i class="fas fa-arrows-alt-v"></i> Uzunlik
                                            </div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('length')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="lengthValue" 
                                                    value="4.6" 
                                                    step="0.1"
                                                    min="0.1"
                                                    onchange="updateFromInput('length')">
                                                <button class="btn-counter" onclick="increaseValue('length')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">metr</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Balandlik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card slide-in-left" style="animation-delay: 0.2s">
                                            <div class="param-label">
                                                <i class="fas fa-ruler-vertical"></i> Balandlik
                                            </div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('height')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="heightValue" 
                                                    value="4.6" 
                                                    step="0.1"
                                                    min="0.1"
                                                    onchange="updateFromInput('height')">
                                                <button class="btn-counter" onclick="increaseValue('height')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">metr</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Maydon ko'rsatkichi -->
                                <div class="area-display slide-in-right">
                                    <p class="area-value"><span id="areaValue">21.16</span> m²</p>
                                    <p class="area-label mb-0">Umumiy maydon</p>
                                </div>
                                
                                <!-- Umumiy yorug'lik -->
                                <div class="total-light-display slide-in-right" id="totalLightDisplay" style="display: none;">
                                    <p class="total-light-value"><span id="totalLightValue">0</span> lm</p>
                                    <p class="total-light-label mb-0">Umumiy yorug'lik</p>
                                </div>
                                
                                <!-- Bino Toifasi va Turi -->
                                <div class="row mt-4">
                                    <div class="col-md-6 col-12 mb-3">
                                        <div class="select-container">
                                            <label class="select-label">
                                                <i class="fas fa-building"></i> Bino toifasi
                                            </label>
                                            <select class="custom-select" id="buildingCategory" onchange="loadRoomCategories()">
                                                <option value="">Kategoriyani tanlang</option>
                                                <!-- API dan yuklanadi -->
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 col-12 mb-3">
                                        <div class="select-container">
                                            <label class="select-label">
                                                <i class="fas fa-door-open"></i> Xona turi
                                            </label>
                                            <select class="custom-select" id="roomType" onchange="loadRoomDetails()">
                                                <option value="">Xona turini tanlang</option>
                                                <!-- API dan yuklanadi -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- O'ng tomon: Xona Rasmi -->
                            <div class="col-lg-6 col-md-12">
                                <div class="room-image-container slide-in-right">
                                    <img src="/images/room.jpg" alt="Xona rasmi" class="img-fluid" id="roomImage">
                                    <!-- O'lcham chiziqlari -->
                                    <div class="dimension-line dimension-line-horizontal" id="widthLine" style="top: 16%; left: 20%;">4.6 m</div>
                                    <div class="dimension-line dimension-line-vertical" id="lengthLine" style="top: 20%; right: 16%;">4.6 m</div>
                                    <div class="dimension-line dimension-line-vertical" id="heightLine" style="top: 50%; right: 5%;">4.6 m</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Xona ma'lumotlari jadvali -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="roomDetails" style="display: none;">
                                    <h5><i class="fas fa-info-circle"></i> XONA TAVSIFI</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Xona nomi</th>
                                                    <th>Kategoriya</th>
                                                    <th>LK (lm/m²)</th>
                                                    <th>RA</th>
                                                    <th>K</th>
                                                    <th>Stol balandligi (m)</th>
                                                    <th>UGR</th>
                                                    <th>Tavsiya etilgan chiroqlar</th>
                                                </tr>
                                            </thead>
                                            <tbody id="roomDetailsContent">
                                                <!-- Xona ma'lumotlari bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lampochka kategoriyalari -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="lampCategoriesContainer" style="display: none;">
                                    <h5><i class="fas fa-lightbulb"></i> LAMPOCHKA TURLARI</h5>
                                    <div class="row" id="lampCategories">
                                        <!-- Lampochka kategoriyalari bu yerda ko'rsatiladi -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tavsiya qilingan lampochkalar -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="recommended-lamps-container" id="recommendedLampsContainer" style="display: none;">
                                    <h5 class="recommended-lamps-title">
                                        <i class="fas fa-star"></i> TAVSIYA QILINGAN LAMPOCHKALAR
                                    </h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0 lamp-details-table">
                                            <thead>
                                                <tr>
                                                    <th>Nomi</th>
                                                    <th>Quvvat (W)</th>
                                                    <th>Rang harorati</th>
                                                    <th>Kuchlanish</th>
                                                    <th>Yorug'lik oqimi (lm)</th>
                                                    <th>Minimal yorug'lik oqimi (lm)</th>
                                                    <th>Samaradorlik (lm/W)</th>
                                                    <th>Rang uzatish indeksi</th>
                                                    <th>Kerakli lampa soni</th>
                                                    <th>Joylashuv</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recommendedLampsContent">
                                                <!-- Tavsiya qilingan lampochkalar bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tanlangan lampochka tafsilotlari -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="lampDetailsContainer" style="display: none;">
                                    <h5><i class="fas fa-clipboard-list"></i> LAMPOCHKA TAFSILOTLARI</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0 lamp-details-table">
                                            <thead>
                                                <tr>
                                                    <th>Nomi</th>
                                                    <th>Quvvat (W)</th>
                                                    <th>Rang harorati</th>
                                                    <th>Kuchlanish</th>
                                                    <th>Yorug'lik oqimi (lm)</th>
                                                    <th>Minimal yorug'lik oqimi (lm)</th>
                                                    <th>Samaradorlik (lm/W)</th>
                                                    <th>Rang uzatish indeksi</th>
                                                    <th>Kerakli lampa soni</th>
                                                    <th>Joylashuv</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lampDetailsContent">
                                                <!-- Lampochka tafsilotlari bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- content close -->
        
        <!-- footer begin -->
        <footer class="section-dark">
            <div class="subfooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <p>© 2024 Texnik me'yorlash va standartlashtirish ilmiy-tadqiqot instituti</p>
                            <p>Barcha huquqlar himoyalangan</p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- footer close -->
    </div>

    <!-- Joylashuv Modal -->
    <div class="modal fade" id="placementModal" tabindex="-1" aria-labelledby="placementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="placementModalLabel">
                        <i class="fas fa-th-large"></i> Lampochkalarni Joylashtirish
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="placement-info">
                                <h6><i class="fas fa-info-circle"></i> Xona ma'lumotlari:</h6>
                                <p><strong><i class="fas fa-arrows-alt-h"></i> Kenglik:</strong> <span id="modalWidth">4.6</span> m</p>
                                <p><strong><i class="fas fa-arrows-alt-v"></i> Uzunlik:</strong> <span id="modalLength">4.6</span> m</p>
                                <p><strong><i class="fas fa-ruler-vertical"></i> Balandlik:</strong> <span id="modalHeight">4.6</span> m</p>
                                <p><strong><i class="fas fa-lightbulb"></i> Lampochkalar soni:</strong> <span id="modalLampsCount">0</span> ta</p>
                                <p><strong><i class="fas fa-tag"></i> Lampa turi:</strong> <span id="modalLampType">-</span></p>
                                <p><strong><i class="fas fa-calculator"></i> Umumiy yorug'lik:</strong> <span id="modalTotalLight">0</span> lm</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="placement-controls">
                                <h6><i class="fas fa-sliders-h"></i> Joylashtirish sozlamalari</h6>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-layer-group"></i> Joylashtirish usuli:</label>
                                    <select class="form-select" id="placementMethod">
                                        <option value="uniform">Bir xil taqsimlash</option>
                                        <option value="grid">To'r ko'rinishida</option>
                                        <option value="custom">Maxsus joylashtirish</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-expand-alt"></i> Lampa o'lchami (m):</label>
                                    <input type="number" class="form-control" id="lampSize" value="0.3" step="0.1" min="0.1">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label"><i class="fas fa-border-all"></i> Devordan masofa (m):</label>
                                    <input type="number" class="form-control" id="wallDistance" value="0.5" step="0.1" min="0">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="placement-canvas-container">
                                <canvas id="placementCanvas" width="800" height="500"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Yopish
                    </button>
                    <button type="button" class="btn btn-primary" onclick="generatePlacement()">
                        <i class="fas fa-sync-alt"></i> Yangi joylashtirish
                    </button>
                    <button type="button" class="btn btn-success" onclick="savePlacement()">
                        <i class="fas fa-download"></i> Saqlash
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // API URL lari
        const API_BASE_URL = 'https://calc.tmsiti.uz/api/v1/lightbulb';
        const BUILDING_CATEGORIES_URL = `${API_BASE_URL}/room_categories/`;
        const LED_PANELS_URL = `${API_BASE_URL}/led-panels/`;
        
        // DOM elementlari
        const buildingCategorySelect = document.getElementById('buildingCategory');
        const roomTypeSelect = document.getElementById('roomType');
        const roomDetailsContainer = document.getElementById('roomDetails');
        const roomDetailsContent = document.getElementById('roomDetailsContent');
        const widthLine = document.getElementById('widthLine');
        const heightLine = document.getElementById('heightLine');
        const totalLightDisplay = document.getElementById('totalLightDisplay');
        const totalLightValue = document.getElementById('totalLightValue');
        const lampCategoriesContainer = document.getElementById('lampCategoriesContainer');
        const lampCategories = document.getElementById('lampCategories');
        const lampDetailsContainer = document.getElementById('lampDetailsContainer');
        const lampDetailsContent = document.getElementById('lampDetailsContent');
        const recommendedLampsContainer = document.getElementById('recommendedLampsContainer');
        const recommendedLampsContent = document.getElementById('recommendedLampsContent');
        
        // Modal uchun o'zgaruvchilar
        let currentLampData = null;
        let canvas = null;
        let ctx = null;
        
        // Joriy xona ma'lumotlari
        let currentRoomData = null;
        let currentLampCategory = null;
        let allLamps = [];
        let lampCategoriesMap = new Map();
        
        // Dastlabki yuklash
        document.addEventListener('DOMContentLoaded', function() {
            loadBuildingCategories();
            updateDimensionLines();
            updateArea();
            showNotification('Xush kelibsiz! Yorug\'lik kalkulyatoridan foydalanishni boshlang.', 'info');
        });
        
        // Notification funksiyasi
        function showNotification(message, type = 'info', title = '') {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'info': 'info-circle',
                'warning': 'exclamation-triangle'
            };
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${icons[type]} fa-lg"></i>
                </div>
                <div class="notification-content">
                    ${title ? `<h6>${title}</h6>` : ''}
                    <p>${message}</p>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Ko'rsatish animatsiyasi
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // 5 soniyadan keyin yashirish
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 5000);
        }
        
        // Kalkulyator funksiyalari
        function decreaseValue(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            value = Math.max(0.1, value - 0.1);
            input.value = value.toFixed(1);
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
            showNotification(`${type === 'width' ? 'Kenglik' : type === 'length' ? 'Uzunlik' : 'Balandlik'} ${value.toFixed(1)}m ga sozlandi`, 'info');
        }
        
        function increaseValue(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            value += 0.1;
            input.value = value.toFixed(1);
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
            showNotification(`${type === 'width' ? 'Kenglik' : type === 'length' ? 'Uzunlik' : 'Balandlik'} ${value.toFixed(1)}m ga sozlandi`, 'info');
        }
        
        function updateFromInput(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            if (isNaN(value) || value < 0.1) {
                value = 0.1;
                input.value = value.toFixed(1);
                showNotification('Qiymat 0.1m dan kam bo\'lishi mumkin emas', 'warning');
            }
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
        }
        
        function updateArea() {
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const area = width * length;
            document.getElementById('areaValue').textContent = area.toFixed(2);
        }
        
        function updateDimensionLines() {
            const width = document.getElementById('widthValue').value;
            const length = document.getElementById('lengthValue').value;
            const height = document.getElementById('heightValue').value;
            
            widthLine.textContent = `${width} m`;
            lengthLine.textContent = `${length} m`;
            heightLine.textContent = `${height} m`;
        }
        
        function getCoefficient() {
            const height = parseFloat(document.getElementById('heightValue').value);
            
            if (height <= 4.0) {
                return 1.3;
            } else if (height <= 6.0) {
                return 1.7;
            } else {
                return 1.8;
            }
        }
        
        function updateTotalLight() {
            const lk = parseFloat(currentRoomData?.lk) || 0;
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const area = width * length;
            const coefficient = getCoefficient();
            const totalLight = lk * area * coefficient;
            
            if (lk > 0) {
                totalLightDisplay.style.display = 'block';
                totalLightValue.textContent = Math.round(totalLight);
            } else {
                totalLightDisplay.style.display = 'none';
            }
        }
        
        function updateLampsCount() {
            if (!currentLampCategory) return;
            
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            // Jadvaldagi barcha lampochkalar uchun kerakli sonni yangilash
            const rows = lampDetailsContent.querySelectorAll('tr');
            rows.forEach(row => {
                const luminousFluxMin = parseFloat(row.dataset.luminousFluxMin) || 1;
                if (totalLight > 0 && luminousFluxMin > 0) {
                    const lampsCount = roundToEven(totalLight / luminousFluxMin);
                    const countCell = row.querySelector('.lamps-count');
                    if (countCell) {
                        countCell.innerHTML = `<span class="lamps-count-badge">${lampsCount} ta</span>`;
                    }
                }
            });
            
            // Tavsiya qilingan lampochkalarni yangilash
            updateRecommendedLamps();
        }
        
        // Tavsiya qilingan lampochkalarni yangilash
        function updateRecommendedLamps() {
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            if (totalLight <= 0 || !currentLampCategory) {
                recommendedLampsContainer.style.display = 'none';
                return;
            }
            
            // Tanlangan kategoriyadagi lampochkalarni olish
            const lamps = lampCategoriesMap.get(currentLampCategory);
            if (!lamps || lamps.length === 0) {
                recommendedLampsContainer.style.display = 'none';
                return;
            }
            
            // Barcha lampochkalar uchun kerakli sonni hisoblash
            const lampCalculations = [];
            lamps.forEach(lamp => {
                const luminousFluxMin = lamp.luminous_flux_max || 1;
                if (luminousFluxMin > 0) {
                    let lampsCount = totalLight / luminousFluxMin;
                    
                    // Juft songa yaxlitlash
                    lampsCount = roundToEven(lampsCount);
                    
                    const power = parseFloat(lamp.power) || 0;
                    const totalPower = lampsCount * power;
                    
                    lampCalculations.push({
                        lamp: lamp,
                        count: lampsCount,
                        power: power,
                        totalPower: totalPower,
                        efficiency: lamp.efficiency || 0
                    });
                }
            });
            
            // Eng kam UMUMIY QUVVAT (lampochka soni * quvvat) bo'yicha saralash
            lampCalculations.sort((a, b) => {
                // Birinchi navbatda eng kam umumiy quvvat
                if (a.totalPower !== b.totalPower) {
                    return a.totalPower - b.totalPower;
                }
                // Agar umumiy quvvat bir xil bo'lsa, eng kam lampochka soni
                return a.count - b.count;
            });
            
            // Eng yaxshi 2 ta variantni olish
            const bestLamps = lampCalculations.slice(0, 2);
            
            // Tavsiya qilingan lampochkalarni ko'rsatish
            if (bestLamps.length > 0) {
                let html = '';
                bestLamps.forEach((item, index) => {
                    const lamp = item.lamp;
                    html += `
                        <tr data-luminous-flux-min="${lamp.luminous_flux_max || 1}">
                            <td>${lamp.name || 'Noma\'lum'}</td>
                            <td>${lamp.power || 'Noma\'lum'}</td>
                            <td>${lamp.color_temperature || 'Noma\'lum'}</td>
                            <td>${lamp.voltage || 'Noma\'lum'}</td>
                            <td>${lamp.luminous_flux || 'Noma\'lum'}</td>
                            <td>${lamp.luminous_flux_max || 'Noma\'lum'}</td>
                            <td>${lamp.efficiency || 'Noma\'lum'}</td>
                            <td>${lamp.color_rendering_index || 'Noma\'lum'}</td>
                            <td class="lamps-count">
                                <span class="lamps-count-badge">${item.count} ta</span>
                            </td>
                            <td>
                                <button class="btn-details" onclick="showPlacementModal(${JSON.stringify(lamp).replace(/"/g, '&quot;')}, ${item.count})">
                                    <i class="fas fa-th-large"></i> Batafsil
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                recommendedLampsContent.innerHTML = html;
                recommendedLampsContainer.style.display = 'block';
                showNotification('Tavsiya qilingan lampochkalar hisoblandi', 'success');
            } else {
                recommendedLampsContainer.style.display = 'none';
            }
        }
        
        // Juft songa yaxlitlash funksiyasi
        function roundToEven(number) {
            const rounded = Math.round(number * 10) / 10; // Bir xona aniqlikda yaxlitlash
            const decimal = rounded % 1;
            const integer = Math.floor(rounded);
            
            // Agar butun qismi toq bo'lsa
            if (integer % 2 !== 0) {
                return integer + 1; // Keyingi juft son
            }
            // Agar butun qismi juft bo'lsa
            else {
                if (decimal <= 0.5) {
                    return integer; // O'zi
                } else {
                    return integer + 2; // Keyingi juft son
                }
            }
        }
        
        // Batafsil tugmasi bosilganda
        function showPlacementModal(lampData, lampsCount) {
            currentLampData = lampData;
            
            // Modal ma'lumotlarini to'ldirish
            document.getElementById('modalWidth').textContent = document.getElementById('widthValue').value;
            document.getElementById('modalLength').textContent = document.getElementById('lengthValue').value;
            document.getElementById('modalHeight').textContent = document.getElementById('heightValue').value;
            document.getElementById('modalLampsCount').textContent = lampsCount;
            document.getElementById('modalLampType').textContent = lampData.name || 'Noma\'lum';
            document.getElementById('modalTotalLight').textContent = totalLightValue.textContent;
            
            // Canvasni tayyorlash
            initializeCanvas();
            
            // Modalni ochish
            const modal = new bootstrap.Modal(document.getElementById('placementModal'));
            modal.show();
            
            showNotification('Lampochkalarni joylashtirish rejimi ochildi', 'info');
        }

        // Canvasni ishga tushirish
        function initializeCanvas() {
            canvas = document.getElementById('placementCanvas');
            ctx = canvas.getContext('2d');
            
            // Canvas o'lchamlarini sozlash
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 400;
            
            // Dastlabki chizish
            generatePlacement();
        }

        // Lampochkalarni joylashtirish
        function generatePlacement() {
            if (!ctx || !currentLampData) return;
            
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const lampsCount = parseInt(document.getElementById('modalLampsCount').textContent);
            const placementMethod = document.getElementById('placementMethod').value;
            const lampSize = parseFloat(document.getElementById('lampSize').value);
            const wallDistance = parseFloat(document.getElementById('wallDistance').value);
            
            // Canvasni tozalash
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Xonani chizish
            drawRoom(width, length);
            
            // Lampochkalarni joylashtirish
            placeLamps(width, length, lampsCount, placementMethod, lampSize, wallDistance);
            
            showNotification('Lampochkalar yangi joylashtirildi', 'success');
        }
        
        // Joylashuvni saqlash
        function savePlacement() {
            if (!canvas) return;
            
            // Canvasni rasmga aylantirish
            const dataURL = canvas.toDataURL('image/png');
            
            // Rasmni yuklab olish uchun link yaratish
            const link = document.createElement('a');
            link.download = `lampochka-joylashuvi-${new Date().getTime()}.png`;
            link.href = dataURL;
            link.click();
            
            showNotification('Joylashuv rasmi yuklab olindi', 'success');
        }

        // Xonani chizish
        function drawRoom(width, length) {
            const scale = Math.min(canvas.width / (width * 1.2), canvas.height / (length * 1.2));
            const roomWidth = width * scale;
            const roomHeight = length * scale;
            const offsetX = (canvas.width - roomWidth) / 2;
            const offsetY = (canvas.height - roomHeight) / 2;
            
            // Xona devorlari
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(offsetX, offsetY, roomWidth, roomHeight);
            
            ctx.strokeStyle = '#234982';
            ctx.lineWidth = 3;
            ctx.strokeRect(offsetX, offsetY, roomWidth, roomHeight);
            
            // Xona o'lchamlari
            ctx.fillStyle = '#234982';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${width}m`, offsetX + roomWidth/2, offsetY - 15);
            
            ctx.save();
            ctx.translate(offsetX - 25, offsetY + roomHeight/2);
            ctx.rotate(-Math.PI/2);
            ctx.fillText(`${length}m`, 0, 0);
            ctx.restore();
            
            return { offsetX, offsetY, roomWidth, roomHeight, scale };
        }

        // Lampochkalarni joylashtirish
        function placeLamps(width, length, lampsCount, method, lampSize, wallDistance) {
            const room = drawRoom(width, length);
            const { offsetX, offsetY, roomWidth, roomHeight, scale } = room;
            const lampRadius = lampSize * scale / 2;
            const wallDistScaled = wallDistance * scale;
            
            let positions = [];
            
            switch(method) {
                case 'uniform':
                    positions = uniformPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY, wallDistScaled);
                    break;
                case 'grid':
                    positions = gridPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY, wallDistScaled);
                    break;
                case 'custom':
                    positions = customPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY);
                    break;
            }
            
            // Lampochkalarni chizish
            positions.forEach((pos, index) => {
                drawLamp(pos.x, pos.y, lampRadius, index);
                drawLightBeam(pos.x, pos.y, lampRadius);
            });
            
            // Lampochkalar sonini ko'rsatish
            ctx.fillStyle = '#234982';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Lampochkalar: ${lampsCount} ta`, 20, 30);
            ctx.fillText(`Usul: ${method === 'uniform' ? 'Bir xil' : method === 'grid' ? 'To\'r' : 'Maxsus'}`, 20, 55);
        }

        // Bir xil taqsimlash
        function uniformPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY, wallDist) {
            const positions = [];
            const rows = Math.ceil(Math.sqrt(lampsCount));
            const cols = Math.ceil(lampsCount / rows);
            
            const effectiveWidth = roomWidth - 2 * wallDist;
            const effectiveHeight = roomHeight - 2 * wallDist;
            
            const cellWidth = effectiveWidth / cols;
            const cellHeight = effectiveHeight / rows;
            
            for (let i = 0; i < rows && positions.length < lampsCount; i++) {
                for (let j = 0; j < cols && positions.length < lampsCount; j++) {
                    positions.push({
                        x: offsetX + wallDist + (j + 0.5) * cellWidth,
                        y: offsetY + wallDist + (i + 0.5) * cellHeight
                    });
                }
            }
            
            return positions;
        }

        // To'r ko'rinishida joylashtirish
        function gridPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY, wallDist) {
            const positions = [];
            const effectiveWidth = roomWidth - 2 * wallDist;
            const effectiveHeight = roomHeight - 2 * wallDist;
            
            const optimalSpacing = Math.sqrt((effectiveWidth * effectiveHeight) / lampsCount);
            const cols = Math.floor(effectiveWidth / optimalSpacing);
            const rows = Math.floor(effectiveHeight / optimalSpacing);
            
            const actualCols = Math.min(cols, Math.ceil(Math.sqrt(lampsCount)));
            const actualRows = Math.min(rows, Math.ceil(lampsCount / actualCols));
            
            const spacingX = effectiveWidth / (actualCols + 1);
            const spacingY = effectiveHeight / (actualRows + 1);
            
            for (let i = 1; i <= actualRows && positions.length < lampsCount; i++) {
                for (let j = 1; j <= actualCols && positions.length < lampsCount; j++) {
                    positions.push({
                        x: offsetX + wallDist + j * spacingX,
                        y: offsetY + wallDist + i * spacingY
                    });
                }
            }
            
            return positions;
        }

        // Maxsus joylashtirish
        function customPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY) {
            const positions = [];
            const centerX = offsetX + roomWidth / 2;
            const centerY = offsetY + roomHeight / 2;
            
            if (lampsCount === 1) {
                positions.push({ x: centerX, y: centerY });
            } else {
                const radius = Math.min(roomWidth, roomHeight) * 0.3;
                for (let i = 0; i < lampsCount; i++) {
                    const angle = (i * 2 * Math.PI) / lampsCount;
                    positions.push({
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle)
                    });
                }
            }
            
            return positions;
        }

        // Lampochkani chizish
        function drawLamp(x, y, radius, index) {
            // Yorug'lik nuri
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius * 2);
            gradient.addColorStop(0, 'rgba(255, 255, 200, 0.8)');
            gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius * 2, 0, 2 * Math.PI);
            ctx.fill();
            
            // Lampochka korpusi
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            ctx.fill();
            
            // Lampochka chegarasi
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Raqam
            ctx.fillStyle = '#000';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(index + 1, x, y);
        }

        // Yorug'lik nurini chizish
        function drawLightBeam(x, y, radius) {
            const gradient = ctx.createRadialGradient(x, y, radius, x, y, radius * 3);
            gradient.addColorStop(0, 'rgba(255, 255, 230, 0.6)');
            gradient.addColorStop(1, 'rgba(255, 255, 230, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius * 3, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // API funksiyalari
        async function loadBuildingCategories() {
            try {
                buildingCategorySelect.innerHTML = '<option value="">Yuklanmoqda...</option>';
                
                const response = await fetch(BUILDING_CATEGORIES_URL);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const categories = await response.json();
                
                buildingCategorySelect.innerHTML = '<option value="">Kategoriyani tanlang</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    buildingCategorySelect.appendChild(option);
                });
                
                showNotification('Bino kategoriyalari yuklandi', 'success');
            } catch (error) {
                console.error('Kategoriyalarni yuklashda xatolik:', error);
                buildingCategorySelect.innerHTML = '<option value="">Xatolik yuz berdi</option>';
                showNotification('Kategoriyalarni yuklashda xatolik', 'error');
            }
        }
        
        async function loadRoomCategories() {
            const categoryId = buildingCategorySelect.value;
            
            if (!categoryId) {
                roomTypeSelect.innerHTML = '<option value="">Xona turini tanlang</option>';
                return;
            }
            
            try {
                roomTypeSelect.innerHTML = '<option value="">Yuklanmoqda...</option>';
                
                const response = await fetch(`${API_BASE_URL}/api/room-categories/${categoryId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                roomTypeSelect.innerHTML = '<option value="">Xona turini tanlang</option>';
                data.subcategories.forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory.id;
                    option.textContent = subcategory.name;
                    roomTypeSelect.appendChild(option);
                });
                
                showNotification('Xona turlari yuklandi', 'success');
            } catch (error) {
                console.error('Xona turlarini yuklashda xatolik:', error);
                roomTypeSelect.innerHTML = '<option value="">Xatolik yuz berdi</option>';
                showNotification('Xona turlarini yuklashda xatolik', 'error');
            }
        }
        
        async function loadRoomDetails() {
            const roomId = roomTypeSelect.value;
            
            if (!roomId) {
                roomDetailsContainer.style.display = 'none';
                totalLightDisplay.style.display = 'none';
                lampCategoriesContainer.style.display = 'none';
                lampDetailsContainer.style.display = 'none';
                recommendedLampsContainer.style.display = 'none';
                currentRoomData = null;
                return;
            }
            
            try {
                roomDetailsContent.innerHTML = '<tr><td colspan="8" class="text-center"><span class="loading-spinner"></span> Ma\'lumotlar yuklanmoqda...</td></tr>';
                roomDetailsContainer.style.display = 'block';
                
                const response = await fetch(`${API_BASE_URL}/rooms/${roomId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const roomDetails = await response.json();
                
                // Agar ma'lumotlar massiv bo'lsa, birinchi elementni olish
                const room = Array.isArray(roomDetails) ? roomDetails[0] : roomDetails;
                currentRoomData = room;
                
                // Ma'lumotlarni jadvalda ko'rsatish
                let html = `
                    <tr>
                        <td>${room.name || 'Noma\'lum'}</td>
                        <td>${room.category_name || 'Noma\'lum'}</td>
                        <td>${room.lk || 'Noma\'lum'}</td>
                        <td>${room.ra || 'Noma\'lum'}</td>
                        <td>${room.k || 'Noma\'lum'}</td>
                        <td>${room.table_height || 'Noma\'lum'}</td>
                        <td>${room.ugr || 'Noma\'lum'}</td>
                        <td>${room.recommended_lamps || 'Noma\'lum'}</td>
                    </tr>
                `;
                
                roomDetailsContent.innerHTML = html;
                
                // Umumiy yorug'likni yangilash
                updateTotalLight();
                
                // Lampochka kategoriyalarini yuklash
                await loadLampCategories();
                
                showNotification('Xona ma\'lumotlari yuklandi', 'success');
                
            } catch (error) {
                console.error('Xona ma\'lumotlarini yuklashda xatolik:', error);
                roomDetailsContent.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Ma\'lumotlarni yuklashda xatolik yuz berdi</td></tr>';
                showNotification('Xona ma\'lumotlarini yuklashda xatolik', 'error');
            }
        }
        
        async function loadLampCategories() {
            try {
                lampCategories.innerHTML = '<div class="col-12 text-center"><span class="loading-spinner"></span> Lampochka turlari yuklanmoqda...</div>';
                lampCategoriesContainer.style.display = 'block';
                
                const response = await fetch(LED_PANELS_URL);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                allLamps = await response.json();
                
                // Lampochkalarni nomi bo'yicha guruhlash
                lampCategoriesMap.clear();
                allLamps.forEach(lamp => {
                    if (!lampCategoriesMap.has(lamp.name)) {
                        lampCategoriesMap.set(lamp.name, []);
                    }
                    lampCategoriesMap.get(lamp.name).push(lamp);
                });
                
                // Lampochka kategoriyalarini ko'rsatish
                let html = '';
                lampCategoriesMap.forEach((lamps, name) => {
                    const uniqueVoltages = new Set();
                    lamps.forEach(lamp => {
                        if (lamp.voltage) uniqueVoltages.add(lamp.voltage);
                    });
                    
                    html += `
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="lamp-category-card" onclick="selectLampCategory('${name}')">
                                <img src="${lamps[0].image || 'https://via.placeholder.com/80'}" alt="${name}" class="lamp-category-image">
                                <div class="lamp-category-name">${name}</div>
                                <small class="text-muted">${lamps.length} turdagi lampochka</small>
                            </div>
                        </div>
                    `;
                });
                
                lampCategories.innerHTML = html;
                
                showNotification('Lampochka turlari yuklandi', 'success');
                
            } catch (error) {
                console.error('Lampochka kategoriyalarini yuklashda xatolik:', error);
                lampCategories.innerHTML = '<div class="col-12 text-center text-danger">Lampochka turlarini yuklashda xatolik yuz berdi</div>';
                showNotification('Lampochka turlarini yuklashda xatolik', 'error');
            }
        }
        
        function selectLampCategory(categoryName) {
            // Barcha kategoriya kartalaridan active klassini olib tashlash
            document.querySelectorAll('.lamp-category-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Tanlangan kategoriyaga active klassini qo'shish
            event.currentTarget.classList.add('active');
            
            // Tanlangan kategoriyani saqlash
            currentLampCategory = categoryName;
            
            // Tanlangan kategoriyadagi lampochkalarni ko'rsatish
            const lamps = lampCategoriesMap.get(categoryName);
            showLampDetails(lamps);
            
            // Tavsiya qilingan lampochkalarni yangilash
            updateRecommendedLamps();
            
            showNotification(`${categoryName} lampochkalari tanlandi`, 'success');
        }
        
        function showLampDetails(lamps) {
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            let html = '';
            lamps.forEach((lamp, index) => {
                const luminousFluxMin = lamp.luminous_flux_max || 1;
                let lampsCount = totalLight > 0 ? totalLight / luminousFluxMin : 0;
                
                // Juft songa yaxlitlash
                if (lampsCount > 0) {
                    lampsCount = roundToEven(lampsCount);
                }
                
                html += `
                    <tr data-luminous-flux-min="${luminousFluxMin}">
                        <td>${lamp.name || 'Noma\'lum'}</td>
                        <td>${lamp.power || 'Noma\'lum'}</td>
                        <td>${lamp.color_temperature || 'Noma\'lum'}</td>
                        <td>${lamp.voltage || 'Noma\'lum'}</td>
                        <td>${lamp.luminous_flux || 'Noma\'lum'}</td>
                        <td>${luminousFluxMin}</td>
                        <td>${lamp.efficiency || 'Noma\'lum'}</td>
                        <td>${lamp.color_rendering_index || 'Noma\'lum'}</td>
                        <td class="lamps-count">
                            ${lampsCount > 0 ? `<span class="lamps-count-badge">${lampsCount} ta</span>` : '-'}
                        </td>
                        <td>
                            ${lampsCount > 0 ? 
                                `<button class="btn-details" onclick="showPlacementModal(${JSON.stringify(lamp).replace(/"/g, '&quot;')}, ${lampsCount})">
                                    <i class="fas fa-th-large"></i> Batafsil
                                </button>` : 
                                '-'
                            }
                        </td>
                    </tr>
                `;
            });
            
            lampDetailsContent.innerHTML = html;
            lampDetailsContainer.style.display = 'block';
        }

        // Oyna o'lchami o'zgarganda canvasni qayta sozlash
        window.addEventListener('resize', function() {
            if (document.getElementById('placementModal').classList.contains('show')) {
                initializeCanvas();
            }
        });
        
        // Esc tugmasi bilan modalni yopish
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('placementModal').classList.contains('show')) {
                const modal = bootstrap.Modal.getInstance(document.getElementById('placementModal'));
                modal.hide();
            }
        });
    </script>
    
    <!-- Javascript Files -->
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>

</body>

</html>