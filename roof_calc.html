<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMSITI Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
   
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="/css/roof_calc.css">
    <style>
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner.active {
            display: block;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .ai-loading {
            color: #666;
            font-style: italic;
        }
        
        .ai-error {
            color: #dc3545;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="toggle-sidebar" onclick="toggleSidebar()">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </div>
        <div class="logo">
            <div class="logo-icon"><i class="fas fa-calculator"></i></div>
            <div class="logo-text">
                <h1>TMSITI</h1>
                <p>Texnik me'yorlash va standartlashtirish ilmiy-tadqiqot instituti</p>
            </div>
        </div>

        <nav>
            <a href="index.html" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Bosh sahifa</span>
            </a>
            <a href="about.html" class="nav-item">
                <i class="fas fa-info-circle"></i>
                <span>Biz haqimizda</span>
            </a>
            <a href="projects.html" class="nav-item">
                <i class="fas fa-project-diagram"></i>
                <span>Loyihalar</span>
            </a>
            <a href="news.html" class="nav-item">
                <i class="fas fa-newspaper"></i>
                <span>Yangiliklar & Blog</span>
            </a>
        </nav>
        <div class="nav-section">
            <div class="nav-section-title">Kalkulyatorlar</div>  
            <a href="light_calc.html" style="text-decoration: none;">
                <div class="calc-item">
                    <div class="calc-dot yellow"></div>
                    <span>Yorug'lik kalkulyatori</span>
                </div>
            </a>
            <a href="heating_calc.html" style="text-decoration: none;">
                <div class="calc-item">
                    <div class="calc-dot red"></div>
                    <span>Isitish tizimi</span>
                </div>
            </a>
            <a href="roof_calc.html" style="text-decoration: none;">
                <div class="calc-item">
                    <div class="calc-dot blue"></div>
                    <span>Tom yopish</span>
                </div>
            </a>
            <a href="green_calc.html" style="text-decoration: none;">
                <div class="calc-item">
                    <div class="calc-dot green"></div>
                    <span>Yashil Qurilish</span>
                </div>
            </a>
        </div>
        <div class="user-badge">
            <div class="user-avatar">F</div>
            <div class="user-info">
                <p>Foydalanuvchi</p>
                <span>Chiqish</span>
            </div>
        </div>
    </div>

    <div class="mobile-toggle" onclick="toggleMobileSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <div class="main-content">
        <div class="header">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" placeholder="Kalkulyatorni qidiring...">
            </div>
            <div class="header-actions">
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-sun" id="themeIcon"></i>
                </div>
                <div class="user-profile">O'Z</div>
                <button class="login-btn">Bog'lanish</button>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="calculator-container">
                    <h3 class="section-title">Tom parametrlari</h3>
                    
                    <form id="roofCalculator">
                        <!-- Tom o'lchamlari -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="roofWidth" class="form-label">Tom eni (m)</label>
                                <input type="number" class="form-control" id="roofWidth" step="0.1" min="0.1" value="10" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="roofLength" class="form-label">Tom uzunligi (m)</label>
                                <input type="number" class="form-control" id="roofLength" step="0.1" min="0.1" value="15" required>
                            </div>
                        </div>
                        
                        <!-- Tom turi va materiallari -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="roofType" class="form-label">Tom turi</label>
                                <select class="form-select" id="roofType">
                                    <option value="0.9">Yassi tom</option>
                                    <option value="1.1">Nishabli tom</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="metalType" class="form-label">Metal turi</label>
                                <select class="form-select" id="metalType">
                                    <option value="5">Metall cherepitsa</option>
                                    <option value="6">Tom uchun profnastil</option>
                                    <option value="6.4">Tosh qoplamali metall cherepitsa</option>
                                    <option value="12">Bitumli cherepitsa</option>
                                    <option value="53">Keramik cherepitsa</option>
                                    <option value="47">Beton cherepitsa</option>
                                    <option value="14">Shifer  list</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Viloyat va tumanlar -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="region" class="form-label">Viloyat</label>
                                <select class="form-select" id="region">
                                    <option value="">Viloyatni tanlang</option>
                                    <option value="Namangan viloyati">Namangan viloyati</option>
                                    <option value="Toshkent viloyati">Toshkent viloyati</option>
                                    <option value="Fargʻona viloyati">Fargʻona viloyati</option>
                                    <option value="Qashqadaryo viloyati">Qashqadaryo viloyati</option>
                                    <option value="Samarqand viloyati">Samarqand viloyati</option>
                                    <option value="Surxondaryo viloyati">Surxondaryo viloyati</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="district" class="form-label">Tuman</label>
                                <select class="form-select" id="district" disabled>
                                    <option value="">Avval viloyatni tanlang</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Hisoblash tugmasi -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="button" class="btn-calculate" id="calculateBtn">
                                <i class="fas fa-calculator me-2"></i>Hisoblash
                            </button>
                        </div>
                    </form>
                    
                    <!-- Natijalar -->
                        <div class="mt-4" id="resultSection" style="display: none;">
                            <div class="result-header">
                                <i class="fas fa-check-circle"></i>
                                <h4>Hisoblash natijalari</h4>
                            </div>
                            
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="result-card">
                                        <div class="result-card-icon" style="background: #2196f3; color: #e3f2fd;">
                                            <i class="fas fa-th"></i>
                                        </div>
                                        <div class="result-card-content">
                                            <div class="result-card-label">TOM MAYDONI</div>
                                            <div class="result-card-value">
                                                <span id="resultArea">0</span> <span class="result-card-unit">m²</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="result-card">
                                        <div class="result-card-icon" style="background: #2196f3; color: #e3f2fd;">
                                            <i class="fas fa-home"></i>
                                        </div>
                                        <div class="result-card-content">
                                            <div class="result-card-label">TOM TURI</div>
                                            <div class="result-card-value" style="font-size: 1rem;">
                                                <span id="resultRoofType">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="result-card">
                                        <div class="result-card-icon" style="background: #2196f3; color: #e3f2fd;">
                                            <i class="fas fa-tools"></i>
                                        </div>
                                        <div class="result-card-content">
                                            <div class="result-card-label">METAL TURI</div>
                                            <div class="result-card-value" style="font-size: 0.95rem;">
                                                <span id="resultMetalType">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="result-card"  style="background-color: #e8f5e9;">
                                        <div class="result-card-icon"   style="background: #4caf50; color: #e8f5e9;">
                                            <i class="fas fa-weight-hanging"></i>
                                        </div>
                                        <div class="result-card-content">
                                            <div class="result-card-label">YAKUNIY YUK</div>
                                            <div class="result-card-value">
                                                <span id="resultFinalLoad">0</span> <span class="result-card-unit">tonna</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3 mt-2">
                                <div class="col-md-4">
                                    <div class="result-info-card">
                                        <div class="result-info-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="result-info-content">
                                            <div class="result-info-label">Joylashuv</div>
                                            <div class="result-info-value" id="resultLocation">-</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="result-info-card">
                                        <div class="result-info-icon">
                                            <i class="fas fa-snowflake"></i>
                                        </div>
                                        <div class="result-info-content">
                                            <div class="result-info-label">Qor yuki (K)</div>
                                            <div class="result-info-value">
                                                <span id="resultSnowLoad">-</span> kN/m²
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="result-info-card">
                                        <div class="result-info-icon">
                                            <i class="fas fa-wind"></i>
                                        </div>
                                        <div class="result-info-content">
                                            <div class="result-info-label">Shamol yuki (H)</div>
                                            <div class="result-info-value">
                                                <span id="resultWindLoad">-</span> kPa
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
            <br><br>
                    <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <!-- AI Maslahat kardini yangilangan holatda yozing -->
                            <div class="ai-card">
                                <!-- Header -->
                                <div class="card-header-section">
                                    <div class="header-top">
                                        <div class="ai-icon">
                                            <i class="bi bi-stars"></i>
                                        </div>
                                        <div class="title-section">
                                            <h1 class="card-title-main">
                                                AI Maslahat
                                                <span class="beta-badge">BETA</span>
                                            </h1>
                                        </div>
                                    </div>
                                    <p class="description-text">
                                        <!-- Matn dinamik ravishda to'ldiriladi -->
                                    </p>
                                </div>

                                <!-- Yükleniyor göstergesi -->
                                <div class="loading-spinner" id="aiLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Yuklanmoqda...</span>
                                    </div>
                                    <p class="ai-loading mt-2">AI maslahat tayyorlanmoqda...</p>
                                </div>

                                <!-- Hata mesajı -->
                                <div class="ai-error" id="aiError" style="display: none;"></div>

                                <!-- Recommendations -->
                                <div class="recommendations-section">
                                    <div class="section-header">
                                        <i class="bi bi-check-circle-fill"><span  style="margin-left: 12px;">Tavsiyalar</span></i>
                                    </div>
                                    
                                    <ul class="recommendation-list" style="padding-left: 35px;">
                                        <!-- Tavsiyalar dinamik ravishda to'ldiriladi -->
                                    </ul>
                                </div>

                                <!-- Footer -->
                                <div class="card-footer-section">
                                    <div class="footer-actions">
                                        <div class="left-actions">
                                            <button class="action-button btn-copy">
                                                <i class="bi bi-clipboard"></i>
                                                Nusxalash
                                            </button>
                                            <button class="action-button btn-share">
                                                <i class="bi bi-share"></i>
                                                Ulashish
                                            </button>
                                        </div>
                                        <button class="action-button btn-primary-action btn-refresh">
                                            <i class="bi bi-arrow-clockwise"></i>
                                            Yangilash
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                </div>
                
            </div>
            
        </div>

    
    </div>
   <script>
        // Viloyat va tuman ma'lumotlari
        const regionsData = [
            {
                name: "Namangan viloyati",
                districts: [
                    { name: "Pop tumani", K: 0.7, H: 0.38 },
                    { name: "Yangikoʻrgʻon tumani", K: 0.7, H: 0.38 },
                    { name: "Chortoq tumani", K: 0.7, H: 0.38 }
                ]
            },
            {
                name: "Toshkent viloyati",
                districts: [
                    { name: "Ohangaron tumani", K: 0.63, H: 1.90 },
                    { name: "Boʻstonliq tumani", K: 0.7, H: 0.38 },
                    { name: "Qibray tumani", K: 0.7, H: 0.38 },
                    { name: "Toshkent tumani", K: 0.7, H: 0.38 }
                ]
            },
            {
                name: "Fargʻona viloyati",
                districts: [
                    { name: "Quva tumani", K: 0.7, H: 0.38 },
                    { name: "Soh tumani", K: 0.7, H: 0.38 },
                    { name: "Fargʻona tumani", K: 0.7, H: 0.38 }
                ]
            },
            {
                name: "Qashqadaryo viloyati",
                districts: [
                    { name: "Dexqonobod tumani", K: 0.7, H: 0.38 },
                    { name: "Qamashi tumani", K: 0.7, H: 0.38 },
                    { name: "Kitob tumani", K: 0.7, H: 0.38 },
                    { name: "Shahrisabz tumani", K: 0.7, H: 0.38 },
                    { name: "Yakkabog tumani", K: 0.7, H: 0.38 }
                ]
            },
            {
                name: "Samarqand viloyati",
                districts: [
                    { name: "Nurabod tumani", K: 0.7, H: 0.38 },
                    { name: "Samarqand tumani", K: 0.7, H: 0.38 },
                    { name: "Urgut tumani", K: 0.7, H: 0.38 }
                ]
            },
            {
                name: "Surxondaryo viloyati",
                districts: [
                    { name: "Oltinsoy tumani", K: 0.7, H: 0.38 },
                    { name: "Boysun tumani", K: 0.7, H: 0.38 },
                    { name: "Sariosiyo tumani", K: 0.7, H: 0.38 },
                    { name: "Sherobod tumani", K: 0.7, H: 0.38 },
                    { name: "Uzun tumani", K: 0.7, H: 0.38 }
                ]
            }
        ];

        // Viloyat tanlanganda tumanlarni yuklash
        document.getElementById('region').addEventListener('change', function() {
            const regionName = this.value;
            const districtSelect = document.getElementById('district');
            
            districtSelect.innerHTML = '<option value="">Tumanni tanlang</option>';
            
            if (regionName) {
                const region = regionsData.find(r => r.name === regionName);
                if (region) {
                    region.districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.name;
                        option.textContent = district.name;
                        option.setAttribute('data-k', district.K);
                        option.setAttribute('data-h', district.H);
                        districtSelect.appendChild(option);
                    });
                    districtSelect.disabled = false;
                }
            } else {
                districtSelect.disabled = true;
            }
        });

        // Sahifa yuklanganda Toshkent viloyati uchun tumanlarni yuklash
        window.addEventListener('DOMContentLoaded', function() {
            const regionSelect = document.getElementById('region');
            regionSelect.dispatchEvent(new Event('change'));
        });

        // Hisoblash funksiyasi
        document.getElementById('calculateBtn').addEventListener('click', async function() {
            const width = parseFloat(document.getElementById('roofWidth').value) || 0;
            const length = parseFloat(document.getElementById('roofLength').value) || 0;
            const area = width * length;
            
            const roofTypeSelect = document.getElementById('roofType');
            const roofTypeValue = parseFloat(roofTypeSelect.value);
            const roofTypeName = roofTypeSelect.options[roofTypeSelect.selectedIndex].text;
            
            const metalTypeSelect = document.getElementById('metalType');
            const metalWeight = parseFloat(metalTypeSelect.value);
            const metalTypeName = metalTypeSelect.options[metalTypeSelect.selectedIndex].text;
            
            const regionSelect = document.getElementById('region');
            const districtSelect = document.getElementById('district');
            const selectedDistrict = districtSelect.options[districtSelect.selectedIndex];
            
            if (width <= 0 || length <= 0) {
                alert('Iltimos, tomning eni va bo\'yini to\'g\'ri kiriting!');
                return;
            }
            
            if (!regionSelect.value || !districtSelect.value) {
                alert('Iltimos, viloyat va tumanni tanlang!');
                return;
            }
            
            const K = parseFloat(selectedDistrict.getAttribute('data-k'));
            const H = parseFloat(selectedDistrict.getAttribute('data-h'));
            
            const snowLoad = K * roofTypeValue;
            const windLoad = H * metalWeight;
            const finalLoad = (area * (metalWeight + snowLoad + windLoad)) / 1000;
            
            // Natijalarni ko'rsatish
            document.getElementById('resultArea').textContent = area.toFixed(2);
            document.getElementById('resultRoofType').textContent = roofTypeName;
            document.getElementById('resultMetalType').textContent = metalTypeName;
            document.getElementById('resultLocation').textContent = `${regionSelect.value}, ${districtSelect.value}`;
            document.getElementById('resultSnowLoad').textContent = snowLoad.toFixed(2);
            document.getElementById('resultWindLoad').textContent = windLoad.toFixed(2);
            document.getElementById('resultFinalLoad').textContent = finalLoad.toFixed(2);
            
            document.getElementById('resultSection').style.display = 'block';
            
            // Smooth scroll to results
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // API ga so'rov yuborish
            await fetchAIRecommendation(area, regionSelect.value, districtSelect.value, snowLoad, windLoad, roofTypeName, metalTypeName);
        });

        // API ga so'rov yuborish funksiyasi
        async function fetchAIRecommendation(area, location, district, snow_load, wind_load, roof_type, metal_type) {
            const aiCard = document.querySelector('.ai-card');
            const loadingSpinner = document.getElementById('aiLoading');
            const errorDiv = document.getElementById('aiError');
            const recommendationList = document.querySelector('.recommendation-list');
            const descriptionText = document.querySelector('.description-text');
            
            // Yuklanishni ko'rsatish
            aiCard.classList.add('visible');
            loadingSpinner.classList.add('active');
            errorDiv.style.display = 'none';
            recommendationList.innerHTML = '';
            descriptionText.innerHTML = '';
            
            // API ga yuboriladigan ma'lumotlar
            const requestData = {
                area: area,
                location: location + ", " + district,
                snow_load: snow_load,
                wind_load: wind_load,
                roof_type: roof_type,
                metal_type: metal_type
            };
            
            console.log("API ga yuborilayotgan ma'lumotlar:", requestData);
            
            try {
                // API ga POST so'rov
                const response = await fetch('https://cal.tmsiti.uz/api/v1/lightbulb/roof-ai/chat/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`API javobi: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log("API dan kelgan javob:", data);
                
                // Yuklanishni yashirish
                loadingSpinner.classList.remove('active');
                
                // Tavsiyalarni ko'rsatish
                if (data.recommendation) {
                    // Description ni yangilash
                    updateTextWithTypingEffect(
                        descriptionText,
                        `Siz tanlagan <strong>${location}, ${district}</strong> hududi uchun iqlim sharoitlarini tahlil qildik. ${getClimateInfo(location, district)}.`
                    );
                    
                    // Tavsiyalarni ko'rsatish
                    displayAPIRecommendations(data.recommendation);
                } else {
                    throw new Error('API dan tavsiya kelmadi');
                }
                
            } catch (error) {
                console.error('API xatosi:', error);
                
                // Yuklanishni yashirish
                loadingSpinner.classList.remove('active');
                
                // Xatani ko'rsatish
                errorDiv.style.display = 'block';
                errorDiv.textContent = `API ga ulanishda xatolik: ${error.message}. Standart tavsiyalar ko'rsatilmoqda.`;
                
                // Standart tavsiyalarni ko'rsatish
                displayStandardRecommendations(location, district, metal_type, roof_type);
            }
        }

        // API dan kelgan tavsiyalarni ko'rsatish
        function displayAPIRecommendations(recommendationText) {
            const recommendationList = document.querySelector('.recommendation-list');
            const descriptionText = document.querySelector('.description-text');
            
            // Recommendation text ni qayta ishlash
            let recommendations = [];
            
            // Agar recommendation text bir nechta bandlardan iborat bo'lsa
            if (recommendationText.includes('\n')) {
                recommendations = recommendationText.split('\n').filter(line => line.trim());
            } else {
                recommendations = [recommendationText];
            }
            
            // Listni tozalash
            recommendationList.innerHTML = '';
            
            // Har bir tavsiyani qo'shish
            recommendations.forEach((rec, index) => {
                const li = document.createElement('li');
                
                // Agar recommendation da raqam bo'lsa, uni saqlash
                let cleanedText = rec.trim();
                
                // Matnni formatlash
                li.innerHTML = cleanedText;
                li.style.opacity = '0';
                li.style.transform = 'translateY(10px)';
                recommendationList.appendChild(li);
                
                // Animatsiya
                setTimeout(() => {
                    li.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    li.style.opacity = '1';
                    li.style.transform = 'translateY(0)';
                }, 100 * (index + 1));
            });
            
            // Agar tavsiyalar bo'sh bo'lsa
            if (recommendations.length === 0) {
                const li = document.createElement('li');
                li.textContent = "API dan tavsiya kelmadi. Iltimos, qayta urinib ko'ring.";
                recommendationList.appendChild(li);
            }
        }

        // Standart tavsiyalarni ko'rsatish
        function displayStandardRecommendations(region, district, metalType, roofType) {
            const recommendationList = document.querySelector('.recommendation-list');
            const descriptionText = document.querySelector('.description-text');
            
            // Standart tavsiyalar
            const recommendations = [
                `${metalType} o'rniga qalinligi 0.5mm dan yuqori bo'lgan profnastil ishlatish shamolga chidamlikni oshiradi.`,
                `${roofType} nishabini biroz oshirish qor yukini kamaytirishga yordam beradi.`,
                `${district} hududida yomg'ir suvi oqimini yaxshilash uchun suv yig'uvchi tamovlarni kengroq o'lchamda o'rnatish tavsiya etiladi.`,
                `Hududning iqlim sharoitlariga mos materiallardan foydalanish tavsiya etiladi.`
            ];
            
            // Description ni yangilash
            updateTextWithTypingEffect(
                descriptionText,
                `Siz tanlagan <strong>${region}, ${district}</strong> hududi uchun iqlim sharoitlarini tahlil qildik. ${getClimateInfo(region, district)}.`
            );
            
            // Listni tozalash
            recommendationList.innerHTML = '';
            
            // Har bir tavsiyani qo'shish
            recommendations.forEach((rec, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${index + 1}.</strong> ${rec}`;
                li.style.opacity = '0';
                li.style.transform = 'translateY(10px)';
                recommendationList.appendChild(li);
                
                // Animatsiya
                setTimeout(() => {
                    li.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    li.style.opacity = '1';
                    li.style.transform = 'translateY(0)';
                }, 100 * (index + 1));
            });
        }

        // AI Maslahat konteyneri yashirin holatda boshlansin
        document.addEventListener('DOMContentLoaded', function() {
            const aiCard = document.querySelector('.ai-card');
            if (aiCard) {
                aiCard.classList.remove('visible');
            }
        });

        function updateTextWithTypingEffect(element, newText) {
            if (!element) return;
            
            // 1. Avval tozalash
            element.innerHTML = '';
            
            // 2. Matnni belgilarga ajratish
            const chars = newText.split('');
            let index = 0;
            
            // 3. Tezlik parametrlari
            const BATCH_SIZE = 1;
            const DELAY = 20;
            
            function typeFast() {
                if (index < chars.length) {
                    // Bir nechta belgini bir vaqtda qo'shish
                    let batchCount = 0;
                    let htmlContent = '';
                    
                    while (batchCount < BATCH_SIZE && index < chars.length) {
                        // HTML teglari uchun
                        if (chars[index] === '<') {
                            // Tegni butunlay olish
                            let tag = '';
                            while (index < chars.length && chars[index] !== '>') {
                                tag += chars[index];
                                index++;
                            }
                            if (index < chars.length) {
                                tag += chars[index]; // '>' ni qo'shish
                                index++;
                            }
                            htmlContent += tag;
                        } else {
                            htmlContent += chars[index];
                            index++;
                            batchCount++;
                        }
                    }
                    
                    // HTML ga qo'shish
                    element.innerHTML += htmlContent;
                    
                    // Scroll
                    element.scrollTop = element.scrollHeight;
                    
                    // Juda qisqa kutish
                    setTimeout(typeFast, DELAY);
                }
            }
            
            // Animatsiyani boshlash
            typeFast();
        }

        function getClimateInfo(region, district) {
            // Hudud bo'yicha iqlim ma'lumotlari
            const climateData = {
                "Namangan viloyati": "shamol tezligi yuqori bo'lganligi sababli, tom yopish materiallarini mustahkamlashda qo'shimcha e'tibor talab qilinadi",
                "Toshkent viloyati": "harorat farqlari katta bo'lganligi sababli, materiallarning haroratga chidamliligi muhim ahamiyatga ega",
                "Fargʻona viloyati": "namlik darajasi yuqori bo'lganligi sababli, korroziyaga chidamli materiallarni tanlash tavsiya etiladi",
                "Qashqadaryo viloyati": "quyosh nuri kuchli bo'lganligi sababli, UV nurlariga chidamli materiallar afzal",
                "Samarqand viloyati": "qor yog'ishi kam bo'lganligi sababli, asosiy e'tibor shamol va yomg'irga qaratilishi kerak",
                "Surxondaryo viloyati": "issiq iqlim sharoitida issiqlik izolyatsiyasi muhim ahamiyatga ega"
            };
            
            return climateData[region] || "iqlim sharoitlari o'rtacha, standart talablarga rioya qilish tavsiya etiladi";
        }

        // Yangilash tugmasi uchun
        document.querySelector('.btn-refresh')?.addEventListener('click', function() {
            const btn = this;
            const originalHTML = btn.innerHTML;
            
            btn.innerHTML = '<i class="bi bi-arrow-clockwise"></i> Yangilanmoqda...';
            btn.disabled = true;
            
            // Qayta hisoblash
            setTimeout(() => {
                // Joriy ma'lumotlarni olish va API ga qayta so'rov yuborish
                const width = parseFloat(document.getElementById('roofWidth').value) || 0;
                const length = parseFloat(document.getElementById('roofLength').value) || 0;
                const area = width * length;
                
                const roofTypeSelect = document.getElementById('roofType');
                const roofTypeName = roofTypeSelect.options[roofTypeSelect.selectedIndex].text;
                
                const metalTypeSelect = document.getElementById('metalType');
                const metalTypeName = metalTypeSelect.options[metalTypeSelect.selectedIndex].text;
                
                const regionSelect = document.getElementById('region');
                const districtSelect = document.getElementById('district');
                
                const selectedDistrict = districtSelect.options[districtSelect.selectedIndex];
                const K = parseFloat(selectedDistrict.getAttribute('data-k'));
                const H = parseFloat(selectedDistrict.getAttribute('data-h'));
                const roofTypeValue = parseFloat(roofTypeSelect.value);
                const metalWeight = parseFloat(metalTypeSelect.value);
                
                const snowLoad = K * roofTypeValue;
                const windLoad = H * metalWeight;
                
                // API ga qayta so'rov yuborish
                fetchAIRecommendation(
                    area, 
                    regionSelect.value, 
                    districtSelect.value, 
                    snowLoad, 
                    windLoad, 
                    roofTypeName, 
                    metalTypeName
                );
                
                btn.innerHTML = '<i class="bi bi-check2"></i> Yangilandi!';
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }, 1500);
            }, 1000);
        });

        // Copy functionality
        document.querySelector('.btn-copy')?.addEventListener('click', function() {
            const description = document.querySelector('.description-text').textContent || '';
            const recommendations = Array.from(document.querySelectorAll('.recommendation-list li'))
                .map(li => li.textContent.trim()).join('\n');
            
            const text = description + '\n\n' + recommendations;
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = this;
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check2"></i> Nusxalandi!';
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                }, 2000);
            });
        });

        // Share functionality
        document.querySelector('.btn-share')?.addEventListener('click', function() {
            if (navigator.share) {
                const description = document.querySelector('.description-text').textContent || '';
                navigator.share({
                    title: 'AI Maslahat - Tom Yopish',
                    text: description.substring(0, 100) + '...',
                    url: window.location.href
                });
            } else {
                alert('Ulashish funksiyasi ushbu brauzerda qo\'llab-quvvatlanmaydi');
            }
        });

    </script>
<script src="/js/scripts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>