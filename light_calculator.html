<!DOCTYPE html>
<html lang="en">

<head>
    <title>TMSITI</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="CoolAir — Air Conditioner & HVAC Repair Website Template" name="description">
    <meta content="" name="keywords">
    <meta content="" name="author">
    <!-- CSS Files
    ================================================== -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/plugins.css" rel="stylesheet" type="text/css">
    <link href="css/swiper.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/coloring.css" rel="stylesheet" type="text/css">
    <!-- color scheme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
    <style>
        body {
            background: linear-gradient(180deg, #F7F8FA 0%, #F3F4F6 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 30px;
            margin-bottom: 30px;
        }
        
        .section-title {
            color: #01060c;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        .parameter-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            margin-top: 18px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            height: 100%;
        }
        
        .param-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        .input-group-custom {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .btn-counter {
            background-color: #03294e;
            border: 1px solid #0d2f49;
            border-radius: 50PX;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #fff;
        }
        
        .btn-counter:hover {
            background-color: #03294e;
            color: #fff;
        }
        
        .value-input {
            width: 70px;
            text-align: center;
            border: 1px solid #c9cbce;
            border-radius: 5px;
            padding: 5px;
            margin: 0 8px;
            font-weight: 600;
        }
        
        .unit-label {
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .area-display {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 12px 32px rgba(30, 60, 114, 0.3);
            position: relative;
            overflow: hidden;
            animation: pulse-glow 3s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 12px 32px rgba(30, 60, 114, 0.3); }
            50% { box-shadow: 0 12px 40px rgba(30, 60, 114, 0.5); }
        }
        
        .area-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 10s linear infinite;
        }
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .area-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .area-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .select-container {
            margin-bottom: 20px;
        }
        
        .select-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: block;
            font-size: 0.9rem;
        }
        
        .custom-select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            background-color: white;
            font-size: 0.9rem;
        }
        
        .room-image-container {
            position: relative;
            text-align: center;
            padding: 15px;
        }
        
        .room-image-container img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .dimension-line {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #4a90e2;
            border-radius: 4px;
            padding: 2px 8px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #2c3e50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .dimension-line-horizontal {
            transform: translateX(-50%);
        }
        
        .dimension-line-vertical {
            transform: translateY(-50%);
        }
        
        .results-container {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #495057;
        }
        
        .result-value {
            color: #2c3e50;
            font-weight: 500;
        }
        
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .table th {
            background-color: #234982;
            color: white;
            font-weight: 600;
            border: none;
            padding: 12px 15px;
        }
        
        .table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        .table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .table tbody tr:hover {
            background-color: #e9ecef;
        }
        
        .total-light-display {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }
        
        .total-light-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .total-light-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .lamp-category-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            height: 100%;
        }
        
        .lamp-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .lamp-category-card.active {
            border-color: #4a90e2;
            background-color: #f0f7ff;
        }
        
        .lamp-category-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .lamp-category-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .lamp-category-count {
            color: #6c757d;
            font-size: 0.8rem;
        }
        
        .lamp-details-table th {
            background-color: #234982;
        }
        
        .lamps-count-badge {
            background-color: #678fd5;
            color: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        /* Modal uchun qo'shimcha stillar */
        .placement-canvas-container {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f8f9fa;
            overflow: auto;
            max-height: 500px;
        }

        .placement-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #234982;
        }

        .placement-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .btn-details {
            background-color: #234982;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-details:hover {
            background-color: #1a3668;
            transform: translateY(-2px);
        }

        .light-beam {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .modal-header {
            background-color: #234982;
            color: #fff;
        }

        .modal-title {
            font-weight: 600;
        }

        .btn-primary {
            background-color: #234982;
            border-color: #234982;
        }

        .btn-primary:hover {
            background-color: #1a3668;
            border-color: #1a3668;
        }
        
        /* Tavsiya qilingan lampochkalar uchun yangi stillar */
        .recommended-lamps-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 2px solid #234982;
        }
        
        .recommended-lamps-title {
            color: #234982;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        /* Modal o'rtada turishi uchun */
        .modal.fade .modal-dialog {
            transition: transform 0.3s ease-out;
            transform: translate(0, -50px);
        }
        
        .modal.show .modal-dialog {
            transform: translate(0, 0);
        }
        
        .modal-xl {
            max-width: 90%;
            margin: 1.75rem auto;
        }
        
        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .params-section .col-4 {
                margin-bottom: 15px;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .lamp-category-card {
                margin-bottom: 15px;
            }
            
            .modal-xl {
                max-width: 95%;
                margin: 0.5rem auto;
            }
        }

        #logo {
          display: flex;
          align-items: center;
          gap: 15px;
          padding: 12px 20px;
          border-radius: 12px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.15);
          max-width: 500px;
          margin: 10px auto;
        }

        #logo a {
          display: flex;
          align-items: center;
          gap: 15px;
          text-decoration: none;
          color: inherit;
          width: 100%;
        }

        .logo-main {
          width: 50px;
          height: 50px;
          padding: 6px;
          background: white;
          border-radius: 50%;
          box-shadow: 0 2px 8px rgba(0,0,0,0.25);
          flex-shrink: 0;
        }

        #logo h6 {
          color: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
          font-size: 13px;
          font-weight: 600;
          line-height: 1.3;
          margin: 0;
          text-align: left;
          flex: 1;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .logo-scroll, .logo-mobile {
          display: none;
        }

        /* Mobil uchun */
        @media (max-width: 768px) {
          #logo {
            padding: 10px 15px;
            max-width: 90%;
          }
          
          .logo-main {
            width: 45px;
            height: 45px;
          }
          
          #logo h6 {
            font-size: 12px;
            line-height: 1.2;
          }
        }
        .section-title {
            color: var(--primary-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2rem;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            border-radius: 2px;
        }
        
        /* Radio button guruhi uchun yangi stillar */
        .radio-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .form-check {
            margin-bottom: 10px;
            padding-left: 30px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            margin-left: -30px;
        }

        .form-check-input:checked {
            background-color: #234982;
            border-color: #234982;
        }

        .form-check-label {
            font-size: 0.9rem;
            color: #495057;
            cursor: pointer;
        }
            
    </style>
</head>

<body>
    <div id="wrapper">
        <div class="float-text show-on-scroll">
            <span><a href="#">Scroll to top</a></span>
        </div>
        <div class="scrollbar-v show-on-scroll"></div>
        
        <!-- page preloader begin -->
        <div id="de-loader"></div>
        <!-- page preloader close -->

        <!-- header begin -->
        <header class="header-light transparent scroll-light has-topbar">
            <div id="topbar">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between xs-hide">
                                <div class="header-widget d-flex">
                                    <div class="topbar-widget"><a href="#"><i class="icofont-phone"></i>+998 71 244-51-84</a></div>
                                    <div class="topbar-widget"><a href="#"><i class="icofont-envelope"></i>info@tmsiti.uz</a></div>
                                </div>

                                <div class="social-icons">
                                    <a href="#"><i class="fa-brands fa-facebook fa-lg"></i></a>
                                    <a href="#"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
                                    <a href="#"><i class="fa-brands fa-youtube fa-lg"></i></a>
                                    <a href="#"><i class="fa-brands fa-pinterest fa-lg"></i></a>
                                    <a href="#"><i class="fa-brands fa-instagram fa-lg"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <!-- logo begin -->
                                    <div id="logo">
                                    <a href="index.html">
                                        <img class="logo-main" src="https://tmsiti.uz/icons/brand.svg" alt="Institut Logosi">
                                        <img class="logo-scroll" src="https://tmsiti.uz/icons/brand.svg" alt="">
                                        <h6>
                                        Texnik me'yorlash va<br>
                                        standartlashtirish<br>
                                        ilmiy-tadqiqot instituti
                                        </h6>
                                        <img class="logo-mobile" src="images/logo-black.webp" alt="">
                                    </a>
                                    </div>
                                <!-- logo close -->
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <ul id="mainmenu">
                                    <li><a class="menu-item" href="#"><i class="fas fa-home"></i> Bosh sahifa</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-info-circle"></i> Biz haqimizda</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-project-diagram"></i> Loyihalar</a></li>
                                    <li><a class="menu-item" href="#"><i class="fas fa-blog"></i> Blog</a></li>
                                </ul>
                            </div>
                            <div class="de-flex-col">
                                <div class="menu_side_area">          
                                   <a href="/" class="btn-main bg-color-2">Bog'lanish</a>
                                    <span id="menu-btn"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- header close -->
        <!-- content begin -->
        <div class="no-bottom no-top" id="content">
            <div id="top"></div>
            <!-- section begin -->
            <section id="subheader2">
                <div class="container relative z-index-1000">
                    <div class="row align-items-center">
                        <div class="col-lg-6 offset-lg-3 text-center">
                            <h1 class="section-title slide-in-left">Yorug'lik Kalkulyatori</h1>
                            <p class="text-muted slide-in-right">Xona parametrlari bo'yicha optimal yorug'likni hisoblang va lampochkalarni joylashtiring</p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- section close -->

            <section class="no-top">
                <div class="container-xxl">
                    <div class="main-container fade-in">
                        <div class="row params-section">
                            <!-- Chap tomon: Parametrlar va Selektlar -->
                            <div class="col-lg-6 col-md-12">
                                <div class="row params-section">
                                    <!-- Kenglik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card">
                                            <div class="param-label">Kenglik</div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('width')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="widthValue" 
                                                    value="3.0" 
                                                    step="0.1"
                                                    onchange="updateFromInput('width')">
                                                <button class="btn-counter" onclick="increaseValue('width')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">m</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Uzunlik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card">
                                            <div class="param-label">Uzunlik</div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('length')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="lengthValue" 
                                                    value="3.0" 
                                                    step="0.1"
                                                    onchange="updateFromInput('length')">
                                                <button class="btn-counter" onclick="increaseValue('length')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">m</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Balandlik -->
                                    <div class="col-md-4 col-sm-4 col-12 mb-3">
                                        <div class="parameter-card">
                                            <div class="param-label">Balandlik</div>
                                            <div class="input-group-custom">
                                                <button class="btn-counter" onclick="decreaseValue('height')">
                                                    <i class="bi bi-dash"></i>
                                                </button>
                                                <input type="number" 
                                                    class="value-input" 
                                                    id="heightValue" 
                                                    value="3.0" 
                                                    step="0.1"
                                                    onchange="updateFromInput('height')">
                                                <button class="btn-counter" onclick="increaseValue('height')">
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                            </div>
                                            <div class="text-center mt-2">
                                                <span class="unit-label">m</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Maydon ko'rsatkichi -->
                                <div class="area-display">
                                    <p class="area-value"><span id="areaValue">9.00</span> m²</p>
                                    <p class="area-label mb-0">Umumiy maydon</p>
                                </div>
                                
                                <!-- Umumiy yorug'lik -->
                                <div class="total-light-display" id="totalLightDisplay" style="display: none;">
                                    <p class="total-light-value"><span id="totalLightValue">0</span> lm</p>
                                    <p class="total-light-label mb-0">Umumiy yorug'lik</p>
                                </div>
                                
                                <!-- Bino Toifasi va Turi -->
                                <div class="row mt-3">
                                    <div class="col-md-6 col-12 mb-3">
                                        <div class="select-container">
                                            <label class="select-label"><i class="fas fa-building"></i> Bino toifasi</label>
                                            <select class="custom-select" id="buildingCategory" onchange="loadRoomCategories()">
                                                <option value="">Kategoriyani tanlang</option>
                                                <!-- API dan yuklanadi -->
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 col-12 mb-3">
                                        <div class="select-container">
                                            <label class="select-label"><i class="fas fa-door-open"></i> Xona turi</label>
                                            <select class="custom-select" id="roomType" onchange="loadRoomDetails()">
                                                <option value="">Xona turini tanlang</option>
                                                <!-- API dan yuklanadi -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- O'ng tomon: Xona Rasmi -->
                            <div class="col-lg-6 col-md-12">
                                <div class="room-image-container">
                                    <img src="/images/room.jpg" alt="Xona rasmi" class="img-fluid" id="roomImage">
                                    <!-- O'lcham chiziqlari -->
                                    <div class="dimension-line dimension-line-horizontal" id="widthLine" style="top: 16%; left: 20%;">3.0 m</div>
                                    <div class="dimension-line dimension-line-vertical" id="lengthLine" style="top: 20%; right: 16%;">3.0 m</div>

                                    <div class="dimension-line dimension-line-vertical" id="heightLine" style="top: 50%; right: 5%;">3.0 m</div>
                                </div>
                            </div>
                        </div>
                                                <!-- Rang tanlash bo'limi -->
                        <!-- Rang tanlash bo'limi -->
                        <div class="row mt-4" id="colorSelectionSection" style="display: none;">
                            <div class="col-12">
                                <div class="results-container">
                                    <h5 class="mb-3">XONA RANGLAR KOMBINATSIYASINI TANLANG</h5>
                                    
                                    <div class="row">
                                        <div class="col-md-12 ">
                                            <div class="select-container">
                                              
                                                <select class="custom-select" id="colorCombination" onchange="updateReflectionCoefficient()">
                                                    <option value="">Kombinatsiyani tanlang</option>
                                                    <option value="80,80,30">Oq, Oq, Kulrang (80/80/30)</option>
                                                    <option value="70,50,20">Ochiq, Ochiq, O'rta kulrang (70/50/20)</option>
                                                    <option value="50,50,10">Kulrang, Ochiq, Qorong'i kulrang (50/50/10)</option>
                                                    <option value="50,30,10">Kulrang, Kulrang, Qorong'i kulrang (50/30/10)</option>
                                                    <option value="30,30,10">Qorong'i, Kulrang, Qorong'i kulrang (30/30/10)</option>
                                                    <option value="0,0,0">Qorong'i, Qorong'i, Qorong'i (0/0/0)</option>
                                                </select>
                                            </div>
                                            


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Xona ma'lumotlari jadvali -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="roomDetails" style="display: none;">
                                    <h5 class="mb-3">XONA TAVSIFI</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Xona nomi</th>
                                                    <th>Kategoriya</th>
                                                    <th>LK (lm/m²)</th>
                                                    <th>RA</th>
                                                    <th>K</th>
                                                    <th>Stol balandligi (m)</th>
                                                    <th>UGR</th>
                                                    <th>Tavsiya etilgan chiroqlar</th>
                                                </tr>
                                            </thead>
                                            <tbody id="roomDetailsContent">
                                                <!-- Xona ma'lumotlari bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        

                        <!-- Lampochka kategoriyalari -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="lampCategoriesContainer" style="display: none;">
                                    <h5 class="mb-3">LAMPOCHKA TURLARI</h5>
                                    <div class="row" id="lampCategories">
                                        <!-- Lampochka kategoriyalari bu yerda ko'rsatiladi -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tavsiya qilingan lampochkalar -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="recommended-lamps-container" id="recommendedLampsContainer" style="display: none;">
                                    <h5 class="recommended-lamps-title">TAVSIYA QILINGAN LAMPOCHKALAR</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0 lamp-details-table">
                                            <thead>
                                                <tr>
                                                    <th>Nomi</th>
                                                    <th>Quvvat (W)</th>
                                                    <th>Rang harorati</th>
                                                    <th>Kuchlanish</th>
                                                    <th>Yorug'lik oqimi (lm)</th>
                                                    <th>Minimal yorug'lik oqimi (lm)</th>
                                                    <th>Samaradorlik (lm/W)</th>
                                                    <th>Rang uzatish indeksi</th>
                                                    <th>Kerakli lampa soni</th>
                                                    <th>Joylashuv</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recommendedLampsContent">
                                                <!-- Tavsiya qilingan lampochkalar bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tanlangan lampochka tafsilotlari -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="results-container" id="lampDetailsContainer" style="display: none;">
                                    <h5 class="mb-3">LAMPOCHKA TAFSILOTLARI</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered mb-0 lamp-details-table">
                                            <thead>
                                                <tr>
                                                    <th>Nomi</th>
                                                    <th>Quvvat (W)</th>
                                                    <th>Rang harorati</th>
                                                    <th>Kuchlanish</th>
                                                    <th>Yorug'lik oqimi (lm)</th>
                                                    <th>Minimal yorug'lik oqimi (lm)</th>
                                                    <th>Samaradorlik (lm/W)</th>
                                                    <th>Rang uzatish indeksi</th>
                                                    <th>Kerakli lampa soni</th>
                                                    <th>Joylashuv</th>
                                                </tr>
                                            </thead>
                                            <tbody id="lampDetailsContent">
                                                <!-- Lampochka tafsilotlari bu yerda ko'rsatiladi -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- content close -->
        <!-- footer begin -->
        <footer class="section-dark">
            <div class="subfooter">
                <div class="container">
                    <!-- Footer content -->
                </div>
            </div>
        </footer>
        <!-- footer close -->
    </div>

    <!-- Joylashuv Modal -->
    <div class="modal fade" id="placementModal" tabindex="-1" aria-labelledby="placementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="placementModalLabel" style="color: #fff;">Lampochkalarni Joylashtirish</h5>
                    <button type="button" style="color: #fff;" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="placement-info">
                                <h6>Xona ma'lumotlari:</h6>
                                <p><strong>Kenglik:</strong> <span id="modalWidth">3.0</span> m</p>
                                <p><strong>Uzunlik:</strong> <span id="modalLength">3.0</span> m</p>
                                <p><strong>Lampochkalar soni:</strong> <span id="modalLampsCount">0</span> ta</p>
                                <p><strong>Lampa turi:</strong> <span id="modalLampType">-</span></p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="placement-controls">
                                <div class="mb-3">
                                    <label class="form-label">Joylashtirish usuli:</label>
                                    <select class="form-select" id="placementMethod">
                                        <option value="uniform">Bir xil taqsimlash</option>
                                        <option value="grid">To'r ko'rinishida</option>
                                        <option value="custom">Maxsus joylashtirish</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Lampa o'lchami (m):</label>
                                    <input type="number" class="form-control" id="lampSize" value="0.3" step="0.1" min="0.1">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="placement-canvas-container">
                                <canvas id="placementCanvas" width="800" height="500"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Yopish</button>
                    <button type="button" class="btn btn-primary" onclick="generatePlacement()">Yangi joylashtirish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // API URL lari
        const API_BASE_URL = 'https://calc.tmsiti.uz/api/v1/lightbulb';
        const BUILDING_CATEGORIES_URL = `${API_BASE_URL}/room_categories/`;
        const LED_PANELS_URL = `${API_BASE_URL}/led-panels/`;
        
        // DOM elementlari
        const buildingCategorySelect = document.getElementById('buildingCategory');
        const roomTypeSelect = document.getElementById('roomType');
        const roomDetailsContainer = document.getElementById('roomDetails');
        const roomDetailsContent = document.getElementById('roomDetailsContent');
        const widthLine = document.getElementById('widthLine');
        const heightLine = document.getElementById('heightLine');
        const totalLightDisplay = document.getElementById('totalLightDisplay');
        const totalLightValue = document.getElementById('totalLightValue');
        const lampCategoriesContainer = document.getElementById('lampCategoriesContainer');
        const lampCategories = document.getElementById('lampCategories');
        const lampDetailsContainer = document.getElementById('lampDetailsContainer');
        const lampDetailsContent = document.getElementById('lampDetailsContent');
        const recommendedLampsContainer = document.getElementById('recommendedLampsContainer');
        const recommendedLampsContent = document.getElementById('recommendedLampsContent');
        const colorSelectionSection = document.getElementById('colorSelectionSection');
        
        // Modal uchun o'zgaruvchilar
        let currentLampData = null;
        let canvas = null;
        let ctx = null;
        
        // Joriy xona ma'lumotlari
        let currentRoomData = null;
        let currentLampCategory = null;
        let allLamps = [];
        let lampCategoriesMap = new Map();
        
        // Dastlabki yuklash
        document.addEventListener('DOMContentLoaded', function() {
            loadBuildingCategories();
            updateDimensionLines();
            
            // Radio button o'zgarishlarini kuzatish
            document.querySelectorAll('input[type="radio"][name="ceilingColor"], input[type="radio"][name="wallColor"], input[type="radio"][name="floorColor"]').forEach(radio => {
                radio.addEventListener('change', calculateReflectionCoefficient);
            });
        });
        
        // Kalkulyator funksiyalari
        function decreaseValue(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            value = Math.max(0.1, value - 0.1);
            input.value = value.toFixed(1);
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
        }
        
        function increaseValue(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            value += 0.1;
            input.value = value.toFixed(1);
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
        }
        
        function updateFromInput(type) {
            const input = document.getElementById(type + 'Value');
            let value = parseFloat(input.value);
            if (isNaN(value) || value < 0.1) {
                value = 0.1;
                input.value = value.toFixed(1);
            }
            updateArea();
            updateDimensionLines();
            updateTotalLight();
            updateLampsCount();
        }
        
        function updateArea() {
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const area = width * length;
            document.getElementById('areaValue').textContent = area.toFixed(2);
        }
        
        function updateDimensionLines() {
            const width = document.getElementById('widthValue').value;
            const length = document.getElementById('lengthValue').value;
            const height = document.getElementById('heightValue').value;
            
            widthLine.textContent = `${width} m`;
            lengthLine.textContent = `${length} m`;
            heightLine.textContent = `${height} m`;
        }
        
        function getCoefficient() {
            const height = parseFloat(document.getElementById('heightValue').value);
            
            if (height <= 4.0) {
                return 1.3;
            } else if (height <= 6.0) {
                return 1.7;
            } else {
                return 1.8;
            }
        }
        
        function updateTotalLight() {
            const lk = parseFloat(currentRoomData?.lk) || 0;
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const area = width * length;
            const coefficient = getCoefficient();
            
            let totalLight = lk * area * coefficient;
            
            // Aks ettirish koeffitsientini hisobga olish (agar tanlangan bo'lsa)
            const reflectionElement = document.getElementById('totalReflectionCoefficient');
            if (reflectionElement && reflectionElement.textContent !== '0%') {
                const reflectionValue = parseFloat(reflectionElement.textContent);
                if (!isNaN(reflectionValue)) {
                    const reflectionFactor = 1 + (reflectionValue / 100);
                    totalLight *= reflectionFactor;
                }
            }
            
            if (lk > 0) {
                totalLightDisplay.style.display = 'block';
                totalLightValue.textContent = Math.round(totalLight);
            } else {
                totalLightDisplay.style.display = 'none';
            }
        }
        
        function updateLampsCount() {
            if (!currentLampCategory) return;
            
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            // Jadvaldagi barcha lampochkalar uchun kerakli sonni yangilash
            const rows = lampDetailsContent.querySelectorAll('tr');
            rows.forEach(row => {
                const luminousFluxMin = parseFloat(row.dataset.luminousFluxMin) || 1;
                if (totalLight > 0 && luminousFluxMin > 0) {
                    let lampsCount = Math.ceil(totalLight / luminousFluxMin);
                    
                    // Juft songa yaxlitlash
                    lampsCount = roundToEven(lampsCount);
                    
                    const countCell = row.querySelector('.lamps-count');
                    if (countCell) {
                        countCell.innerHTML = `<span class="lamps-count-badge">${lampsCount} ta</span>`;
                    }
                }
            });
            
            // Tavsiya qilingan lampochkalarni yangilash
            updateRecommendedLamps();
        }
        
        // Tavsiya qilingan lampochkalarni yangilash
        function updateRecommendedLamps() {
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            if (totalLight <= 0 || !currentLampCategory) {
                recommendedLampsContainer.style.display = 'none';
                return;
            }
            
            // Tanlangan kategoriyadagi lampochkalarni olish
            const lamps = lampCategoriesMap.get(currentLampCategory);
            if (!lamps || lamps.length === 0) {
                recommendedLampsContainer.style.display = 'none';
                return;
            }
            
            // Barcha lampochkalar uchun kerakli sonni hisoblash
            const lampCalculations = [];
            lamps.forEach(lamp => {
                const luminousFluxMin = lamp.luminous_flux_max || 1;
                if (luminousFluxMin > 0) {
                    let lampsCount = totalLight / luminousFluxMin;
                    
                    // Juft songa yaxlitlash
                    lampsCount = roundToEven(lampsCount);
                    
                    const power = parseFloat(lamp.power) || 0;
                    const totalPower = lampsCount * power;
                    
                    lampCalculations.push({
                        lamp: lamp,
                        count: lampsCount,
                        power: power,
                        totalPower: totalPower,
                        efficiency: lamp.efficiency || 0
                    });
                }
            });
            
            // Eng kam UMUMIY QUVVAT (lampochka soni * quvvat) bo'yicha saralash
            lampCalculations.sort((a, b) => {
                // Birinchi navbatda eng kam umumiy quvvat
                if (a.totalPower !== b.totalPower) {
                    return a.totalPower - b.totalPower;
                }
                // Agar umumiy quvvat bir xil bo'lsa, eng kam lampochka soni
                return a.count - b.count;
            });
            
            // Eng yaxshi 2 ta variantni olish
            const bestLamps = lampCalculations.slice(0, 2);
            
            // Tavsiya qilingan lampochkalarni ko'rsatish
            if (bestLamps.length > 0) {
                let html = '';
                bestLamps.forEach((item, index) => {
                    const lamp = item.lamp;
                    html += `
                        <tr data-luminous-flux-min="${lamp.luminous_flux_max || 1}">
                            <td>${lamp.name || 'Noma\'lum'}</td>
                            <td>${lamp.power || 'Noma\'lum'}</td>
                            <td>${lamp.color_temperature || 'Noma\'lum'}</td>
                            <td>${lamp.voltage || 'Noma\'lum'}</td>
                            <td>${lamp.luminous_flux || 'Noma\'lum'}</td>
                            <td>${lamp.luminous_flux_max || 'Noma\'lum'}</td>
                            <td>${lamp.efficiency || 'Noma\'lum'}</td>
                            <td>${lamp.color_rendering_index || 'Noma\'lum'}</td>
                            <td class="lamps-count">
                                <span class="lamps-count-badge">${item.count} ta</span>
                            </td>
                            <td>
                                <button class="btn-details" onclick="showPlacementModal(${JSON.stringify(lamp).replace(/"/g, '&quot;')}, ${item.count})">
                                    Batafsil
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                recommendedLampsContent.innerHTML = html;
                recommendedLampsContainer.style.display = 'block';
            } else {
                recommendedLampsContainer.style.display = 'none';
            }
        }
        
        // Juft songa yaxlitlash funksiyasi
        function roundToEven(number) {
            const rounded = Math.round(number * 10) / 10; // Bir xona aniqlikda yaxlitlash
            const decimal = rounded % 1;
            const integer = Math.floor(rounded);
            
            // Agar butun qismi toq bo'lsa
            if (integer % 2 !== 0) {
                return integer + 1; // Keyingi juft son
            }
            // Agar butun qismi juft bo'lsa
            else {
                if (decimal <= 0.5) {
                    return integer; // O'zi
                } else {
                    return integer + 2; // Keyingi juft son
                }
            }
        }
        
        // Aks ettirish koeffitsientini hisoblash funksiyasi
        function calculateReflectionCoefficient() {
            // Tanlangan qiymatlarni olish
            const ceilingColor = document.querySelector('input[name="ceilingColor"]:checked').value;
            const wallColor = document.querySelector('input[name="wallColor"]:checked').value;
            const floorColor = document.querySelector('input[name="floorColor"]:checked').value;
            
            // O'rtacha koeffitsientni hisoblash (soddalashtirilgan formula)
            const avgCoefficient = (parseFloat(ceilingColor) + parseFloat(wallColor) + parseFloat(floorColor)) / 3;
            
            // Natijani ko'rsatish
            document.getElementById('totalReflectionCoefficient').textContent = avgCoefficient.toFixed(1) + '%';
            
            // Yorug'likni qayta hisoblash
            updateTotalLight();
            
            // Lampochka sonini yangilash
            updateLampsCount();
        }
        
        // Batafsil tugmasi bosilganda
        function showPlacementModal(lampData, lampsCount) {
            currentLampData = lampData;
            
            // Modal ma'lumotlarini to'ldirish
            document.getElementById('modalWidth').textContent = document.getElementById('widthValue').value;
            document.getElementById('modalLength').textContent = document.getElementById('lengthValue').value;
            document.getElementById('modalLampsCount').textContent = lampsCount;
            document.getElementById('modalLampType').textContent = lampData.name || 'Noma\'lum';
            
            // Canvasni tayyorlash
            initializeCanvas();
            
            // Modalni ochish
            const modal = new bootstrap.Modal(document.getElementById('placementModal'));
            modal.show();
        }

        // Canvasni ishga tushirish
        function initializeCanvas() {
            canvas = document.getElementById('placementCanvas');
            ctx = canvas.getContext('2d');
            
            // Canvas o'lchamlarini sozlash
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 40;
            canvas.height = 400;
            
            // Dastlabki chizish
            generatePlacement();
        }

        // Lampochkalarni joylashtirish
        function generatePlacement() {
            if (!ctx || !currentLampData) return;
            
            const width = parseFloat(document.getElementById('widthValue').value);
            const length = parseFloat(document.getElementById('lengthValue').value);
            const lampsCount = parseInt(document.getElementById('modalLampsCount').textContent);
            const placementMethod = document.getElementById('placementMethod').value;
            const lampSize = parseFloat(document.getElementById('lampSize').value);
            
            // Canvasni tozalash
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Xonani chizish
            drawRoom(width, length);
            
            // Lampochkalarni joylashtirish
            placeLamps(width, length, lampsCount, placementMethod, lampSize);
        }

        // Xonani chizish
        function drawRoom(width, length) {
            const scale = Math.min(canvas.width / (width * 1.2), canvas.height / (length * 1.2));
            const roomWidth = width * scale;
            const roomHeight = length * scale;
            const offsetX = (canvas.width - roomWidth) / 2;
            const offsetY = (canvas.height - roomHeight) / 2;
            
            // Xona devorlari
            ctx.strokeStyle = '#234982';
            ctx.lineWidth = 3;
            ctx.strokeRect(offsetX, offsetY, roomWidth, roomHeight);
            
            // Xona o'lchamlari
            ctx.fillStyle = '#234982';
            ctx.font = '12px Arial';
            ctx.fillText(`${width}m`, offsetX + roomWidth/2 - 15, offsetY - 10);
            ctx.fillText(`${length}m`, offsetX - 30, offsetY + roomHeight/2);
            
            return { offsetX, offsetY, roomWidth, roomHeight, scale };
        }

        // Lampochkalarni joylashtirish
        function placeLamps(width, length, lampsCount, method, lampSize) {
            const room = drawRoom(width, length);
            const { offsetX, offsetY, roomWidth, roomHeight, scale } = room;
            const lampRadius = lampSize * scale / 2;
            
            let positions = [];
            
            switch(method) {
                case 'uniform':
                    positions = uniformPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY);
                    break;
                case 'grid':
                    positions = gridPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY);
                    break;
                case 'custom':
                    positions = customPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY);
                    break;
            }
            
            // Lampochkalarni chizish
            positions.forEach((pos, index) => {
                drawLamp(pos.x, pos.y, lampRadius, index);
                drawLightBeam(pos.x, pos.y, lampRadius);
            });
        }

        // Bir xil taqsimlash
        function uniformPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY) {
            const positions = [];
            const rows = Math.ceil(Math.sqrt(lampsCount));
            const cols = Math.ceil(lampsCount / rows);
            
            const cellWidth = roomWidth / cols;
            const cellHeight = roomHeight / rows;
            
            for (let i = 0; i < rows && positions.length < lampsCount; i++) {
                for (let j = 0; j < cols && positions.length < lampsCount; j++) {
                    positions.push({
                        x: offsetX + (j + 0.5) * cellWidth,
                        y: offsetY + (i + 0.5) * cellHeight
                    });
                }
            }
            
            return positions;
        }

        // To'r ko'rinishida joylashtirish
        function gridPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY) {
            const positions = [];
            const optimalSpacing = Math.sqrt((roomWidth * roomHeight) / lampsCount);
            const cols = Math.floor(roomWidth / optimalSpacing);
            const rows = Math.floor(roomHeight / optimalSpacing);
            
            const actualCols = Math.min(cols, Math.ceil(Math.sqrt(lampsCount)));
            const actualRows = Math.min(rows, Math.ceil(lampsCount / actualCols));
            
            const spacingX = roomWidth / (actualCols + 1);
            const spacingY = roomHeight / (actualRows + 1);
            
            for (let i = 1; i <= actualRows && positions.length < lampsCount; i++) {
                for (let j = 1; j <= actualCols && positions.length < lampsCount; j++) {
                    positions.push({
                        x: offsetX + j * spacingX,
                        y: offsetY + i * spacingY
                    });
                }
            }
            
            return positions;
        }

        // Maxsus joylashtirish
        function customPlacement(roomWidth, roomHeight, lampsCount, offsetX, offsetY) {
            const positions = [];
            const centerX = offsetX + roomWidth / 2;
            const centerY = offsetY + roomHeight / 2;
            
            if (lampsCount === 1) {
                positions.push({ x: centerX, y: centerY });
            } else {
                const radius = Math.min(roomWidth, roomHeight) * 0.3;
                for (let i = 0; i < lampsCount; i++) {
                    const angle = (i * 2 * Math.PI) / lampsCount;
                    positions.push({
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle)
                    });
                }
            }
            
            return positions;
        }

        // Lampochkani chizish
        function drawLamp(x, y, radius, index) {
            // Lampochka korpusi
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            ctx.fill();
            
            // Lampochka chegarasi
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Raqam
            ctx.fillStyle = '#000';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(index + 1, x, y);
        }

        // Yorug'lik nurini chizish
        function drawLightBeam(x, y, radius) {
            const gradient = ctx.createRadialGradient(x, y, radius, x, y, radius * 3);
            gradient.addColorStop(0, 'rgba(255, 255, 200, 0.8)');
            gradient.addColorStop(1, 'rgba(255, 255, 200, 0)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius * 3, 0, 2 * Math.PI);
            ctx.fill();
        }
        
        // API funksiyalari
        async function loadBuildingCategories() {
            try {
                buildingCategorySelect.innerHTML = '<option value="">Yuklanmoqda...</option>';
                
                const response = await fetch(BUILDING_CATEGORIES_URL);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const categories = await response.json();
                
                buildingCategorySelect.innerHTML = '<option value="">Kategoriyani tanlang</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    buildingCategorySelect.appendChild(option);
                });
            } catch (error) {
                console.error('Kategoriyalarni yuklashda xatolik:', error);
                buildingCategorySelect.innerHTML = '<option value="">Xatolik yuz berdi</option>';
            }
        }
        
        async function loadRoomCategories() {
            const categoryId = buildingCategorySelect.value;
            
            if (!categoryId) {
                roomTypeSelect.innerHTML = '<option value="">Xona turini tanlang</option>';
                return;
            }
            
            try {
                roomTypeSelect.innerHTML = '<option value="">Yuklanmoqda...</option>';
                
                const response = await fetch(`${API_BASE_URL}/api/room-categories/${categoryId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                roomTypeSelect.innerHTML = '<option value="">Xona turini tanlang</option>';
                data.subcategories.forEach(subcategory => {
                    const option = document.createElement('option');
                    option.value = subcategory.id;
                    option.textContent = subcategory.name;
                    roomTypeSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Xona turlarini yuklashda xatolik:', error);
                roomTypeSelect.innerHTML = '<option value="">Xatolik yuz berdi</option>';
            }
        }
        
        async function loadRoomDetails() {
            const roomId = roomTypeSelect.value;
            
            if (!roomId) {
                roomDetailsContainer.style.display = 'none';
                totalLightDisplay.style.display = 'none';
                lampCategoriesContainer.style.display = 'none';
                lampDetailsContainer.style.display = 'none';
                recommendedLampsContainer.style.display = 'none';
                colorSelectionSection.style.display = 'none';
                currentRoomData = null;
                return;
            }
            
            try {
                roomDetailsContent.innerHTML = '<tr><td colspan="8" class="text-center"><span class="loading-spinner"></span> Ma\'lumotlar yuklanmoqda...</td></tr>';
                roomDetailsContainer.style.display = 'block';
                
                const response = await fetch(`${API_BASE_URL}/rooms/${roomId}/`);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                const roomDetails = await response.json();
                
                // Agar ma'lumotlar massiv bo'lsa, birinchi elementni olish
                const room = Array.isArray(roomDetails) ? roomDetails[0] : roomDetails;
                currentRoomData = room;
                
                // Ma'lumotlarni jadvalda ko'rsatish
                let html = `
                    <tr>
                        <td>${room.name || 'Noma\'lum'}</td>
                        <td>${room.category_name || 'Noma\'lum'}</td>
                        <td>${room.lk || 'Noma\'lum'}</td>
                        <td>${room.ra || 'Noma\'lum'}</td>
                        <td>${room.k || 'Noma\'lum'}</td>
                        <td>${room.table_height || 'Noma\'lum'}</td>
                        <td>${room.ugr || 'Noma\'lum'}</td>
                        <td>${room.recommended_lamps || 'Noma\'lum'}</td>
                    </tr>
                `;
                
                roomDetailsContent.innerHTML = html;
                
                // Rang tanlash bo'limini ko'rsatish
                colorSelectionSection.style.display = 'block';
                
                // Umumiy yorug'likni yangilash
                updateTotalLight();
                
                // Lampochka kategoriyalarini yuklash
                await loadLampCategories();
                
            } catch (error) {
                console.error('Xona ma\'lumotlarini yuklashda xatolik:', error);
                roomDetailsContent.innerHTML = '<tr><td colspan="8" class="text-center text-danger">Ma\'lumotlarni yuklashda xatolik yuz berdi</td></tr>';
                colorSelectionSection.style.display = 'none';
            }
        }
        
        async function loadLampCategories() {
            try {
                lampCategories.innerHTML = '<div class="col-12 text-center"><span class="loading-spinner"></span> Lampochka turlari yuklanmoqda...</div>';
                lampCategoriesContainer.style.display = 'block';
                
                const response = await fetch(LED_PANELS_URL);
                if (!response.ok) {
                    throw new Error(`HTTP xatosi! Status: ${response.status}`);
                }
                
                allLamps = await response.json();
                
                // Lampochkalarni nomi bo'yicha guruhlash
                lampCategoriesMap.clear();
                allLamps.forEach(lamp => {
                    if (!lampCategoriesMap.has(lamp.name)) {
                        lampCategoriesMap.set(lamp.name, []);
                    }
                    lampCategoriesMap.get(lamp.name).push(lamp);
                });
                
                // Lampochka kategoriyalarini ko'rsatish
                let html = '';
                lampCategoriesMap.forEach((lamps, name) => {
                    const uniqueVoltages = new Set();
                    lamps.forEach(lamp => {
                        if (lamp.voltage) uniqueVoltages.add(lamp.voltage);
                    });
                    
                    html += `
                        <div class="col-lg-3 col-md-4 col-sm-6 mb-3">
                            <div class="lamp-category-card" onclick="selectLampCategory('${name}')">
                                <img src="${lamps[0].image || 'https://via.placeholder.com/80'}" alt="${name}" class="lamp-category-image">
                                <div class="lamp-category-name">${name}</div>
                            </div>
                        </div>
                    `;
                });
                
                lampCategories.innerHTML = html;
                
            } catch (error) {
                console.error('Lampochka kategoriyalarini yuklashda xatolik:', error);
                lampCategories.innerHTML = '<div class="col-12 text-center text-danger">Lampochka turlarini yuklashda xatolik yuz berdi</div>';
            }
        }
        
        function selectLampCategory(categoryName) {
            // Barcha kategoriya kartalaridan active klassini olib tashlash
            document.querySelectorAll('.lamp-category-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Tanlangan kategoriyaga active klassini qo'shish
            event.currentTarget.classList.add('active');
            
            // Tanlangan kategoriyani saqlash
            currentLampCategory = categoryName;
            
            // Tanlangan kategoriyadagi lampochkalarni ko'rsatish
            const lamps = lampCategoriesMap.get(categoryName);
            showLampDetails(lamps);
            
            // Tavsiya qilingan lampochkalarni yangilash
            updateRecommendedLamps();
        }
        
        function showLampDetails(lamps) {
            const totalLight = parseFloat(totalLightValue.textContent) || 0;
            
            let html = '';
            lamps.forEach((lamp, index) => {
                const luminousFluxMin = lamp.luminous_flux_max || 1;
                let lampsCount = totalLight > 0 ? totalLight / luminousFluxMin : 0;
                
                // Juft songa yaxlitlash
                if (lampsCount > 0) {
                    lampsCount = roundToEven(lampsCount);
                }
                
                html += `
                    <tr data-luminous-flux-min="${luminousFluxMin}">
                        <td>${lamp.name || 'Noma\'lum'}</td>
                        <td>${lamp.power || 'Noma\'lum'}</td>
                        <td>${lamp.color_temperature || 'Noma\'lum'}</td>
                        <td>${lamp.voltage || 'Noma\'lum'}</td>
                        <td>${lamp.luminous_flux || 'Noma\'lum'}</td>
                        <td>${luminousFluxMin}</td>
                        <td>${lamp.efficiency || 'Noma\'lum'}</td>
                        <td>${lamp.color_rendering_index || 'Noma\'lum'}</td>
                        <td class="lamps-count">
                            ${lampsCount > 0 ? `<span class="lamps-count-badge">${lampsCount} ta</span>` : '-'}
                        </td>
                        <td>
                            ${lampsCount > 0 ? 
                                `<button class="btn-details" onclick="showPlacementModal(${JSON.stringify(lamp).replace(/"/g, '&quot;')}, ${lampsCount})">
                                    Batafsil
                                </button>` : 
                                '-'
                            }
                        </td>
                    </tr>
                `;
            });
            
            lampDetailsContent.innerHTML = html;
            lampDetailsContainer.style.display = 'block';
        }

        // Oyna o'lchami o'zgarganda canvasni qayta sozlash
        window.addEventListener('resize', function() {
            if (document.getElementById('placementModal').classList.contains('show')) {
                initializeCanvas();
            }
        });
    </script>
    <!-- Javascript Files
    ================================================== -->
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>

</body>

</html>